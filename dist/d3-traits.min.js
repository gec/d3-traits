/*! d3-traits - v0.0.1 - 2017-03-10
* https://github.com/gec/d3-traits
* Copyright (c) 2017 d3-traits; Licensed ,  */
!function(a){function b(a,b){for(var c in a)c in b||(b[c]=a[c])}function c(a,b){var c=a[b];return c||(a[b]={},c=a[b]),c}function d(a){return"x"===a.charAt(0)}function e(a){return"y"===a.charAt(0)}function f(a){return a[0]}function g(a){return a[a.length-1]}function h(b,c){return a.max(b,function(a){return c(a).length})>0}function i(a){return"[object Date]"!==Object.prototype.toString.call(a)?!1:!isNaN(a.getTime())}function j(b,c){return a.trait.utils.isX(c)?[b.minRangeMarginLeft(c),b.chartWidth()-b.minRangeMarginRight(c)]:[b.chartHeight()-b.minRangeMarginBottom(c),b.minRangeMarginTop(c)]}function k(b,c,d){var e=d.domain();return a.trait.utils.isX(c)?[[0,d(e[0])],[d(e[1]),b.chartWidth()]]:[[0,d(e[0])],[d(e[1]),b.chartHeight()]]}function l(a,b){var c=parseFloat(a);return isNaN(c)?b:c}function m(a,b){if(!a)return b;var c={};return c.top=l(a.top,b.top),c.right=l(a.right,b.right),c.bottom=l(a.bottom,b.bottom),c.left=l(a.left,b.left),c}function n(a,b,c){if(!a)return c;if(Array.isArray(a)){var d=a.length;if(0===d)return c;var e=Math.min(d-1,b),f=a[e];return f?f:c}return a}function o(a,b,c){if(!a)return c;if("object"==typeof a){var d=a[b];return d?d:c}return a}function p(a){if(null==a||"object"!=typeof a)return a;var b=a.constructor();for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function q(){var a,b,c,d,e=arguments[0]||{},f=arguments.length;for(a=1;f>a;a++)if(null!=(b=arguments[a]))for(c in b)d=b[c],d&&(e[c]=d);return e}function r(a,b){for(var c in b)a.hasOwnProperty(c)||b[c]&&(a[c]=b[c]);return a}function s(a,b){var c=p(a);return c||(c={}),r(c,b)}function t(a,b,c){function d(a,b){return"_"+a+"_"+b}function e(a,b,c){return v&&console.log("makeVirtual "+a),function(a,b){return function(){var a=this._super;this._super=c;var d=b.apply(this,arguments);return this._super=a,d}}(a,b)}v&&console.log("trait( "+a.name+")");var f,g,h=this;h.config=b,h._super=c,h.index=-1,h.__leafTrait=null,h.getImp=function(){return g},h.trait=function(a,b){var c=new t(a,b,g);return c.getImp()},h.call=function(a,b){return b||(b=this),this.__leafTrait||(this.__leafTrait=b),this._super&&this._super.call(a,b),a.call(g),g},h.callTraits=function(a){return this.__leafTrait?this.__leafTrait.call(a):this},h.__replaceVirtual=function(a,b){g.hasOwnProperty(a)&&(g[a]=b),c&&c.__replaceVirtual(a,b)},h.__virtualize=function(b,d){v&&console.log("__virtualize begin "+a.name+" name="+b);var f=null;return g.hasOwnProperty(b)&&"function"==typeof g[b]?(v&&console.log("__virtualize "+a.name+" name="+b+" hasFunction"),f=e(b,d,g[b]),g[b]=f,c&&c.__replaceVirtual(b,f)):v&&console.log("__virtualize "+a.name+" name="+b+" hasFunction NOT  "),f},h.__makeVTable=function(){v&&console.log("__makeVTable begin "+a.name);var b,d;for(b in g)d=c.__virtualize(b,g[b]),d?(v&&console.log(a.name+".__makeVTable name "+b+"   virtualized"),g[b]=d):v&&console.log(a.name+".__makeVTable name "+b+" ! virtualized");for(b in c)b in g||(g[b]=c[b]);v&&console.log("__makeVTable end")},h.__getRoot=function(){return h._super?h._super.__getRoot():h},f=d(a.name,h._traitIndex),c&&(h.config=s(b,h.__getRoot().config)),g=a(c,h.config,f),c&&h.__makeVTable(),g.call=h.call,g.callTraits=h.callTraits,g.trait=h.trait,g.getImp=h.getImp,g.config=h.config,g.__makeVTable=h.__makeVTable,g.__virtualize=h.__virtualize,g.__replaceVirtual=h.__replaceVirtual,g.__getRoot=h.__getRoot,g._super=c}function u(a,b){return new t(a,b).getImp()}var v=!1;Array.isArray=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},t.prototype={trait:function(a,b){var c=new t(a,b,this),d=c.getImp();return d},__getRoot:function(){return this._super?this._super.__getRoot():this},callInstance:function(a){var b=this;a.call(function(a){a.each(function(c){b(c,a)})})},call:function(a,b){return b||(b=this),this.__leafTrait=b,this._super&&this._super.call(a,b),a.call(this),this}},t.prototype.constructor=t,a.selection.prototype.trait=function(a,c){if(Array.isArray(a))for(var d in a)this.trait(a[d]);else{this._traitsInitialize();var e=this.traits.length,f={};e>0&&(f=this.traits[e-1]);var g=s(this._traitsConfig,c),h=a(f,g,this);b(f,h),this.call(h),this.traits.push(h)}return this},a.selection.prototype.callTraits=function(){for(var a in this.traits){var b=this.traits[a];this.call(b)}return this};var w={};a.selection.prototype._traitsInitialize=function(){return this._traitsConfig||(this._traitsConfig=p(w)),this.traits||(this.traits=[]),this},a.selection.prototype.traitConfig=function(a){this._traitsInitialize();for(var b in a)this._traitsConfig[b]=a[b];return this},a.trait=u,a.trait.config={},a.trait.axis={},a.trait.chart={utils:{}},a.trait.control={},a.trait.focus={},a.trait.label={},a.trait.layout={},a.trait.legend={},a.trait.scale={},a.trait.utils={clone:p,extend:q,isX:d,isY:e,isData:h,isValidDate:i,extentMin:f,extentMax:g,getScaleRange:j,getScaleExtensions:k,getTraitCache:c,configMargin:m,configFloat:l,getValueOrArrayItem:n,getValueOrObjectProperty:o}}(d3),function(a,b){function c(a,b){switch(arguments.length){case 0:this.x=0,this.y=0;break;case 1:this.x=a.x,this.y=a.y;break;default:this.x=a,this.y=b}}function d(a,b){arguments.length<=0?(this.width=0,this.height=0):(this.width=a,this.height=b)}function e(){var a,b;switch(arguments.length){case 0:this.top=0,this.right=0,this.bottom=0,this.left=0;break;case 1:a=arguments[0],this.top=a,this.right=a,this.bottom=a,this.left=a;break;case 2:a=arguments[0],b=arguments[1],this.top=a,this.right=b,this.bottom=a,this.left=b;break;case 3:this.top=arguments[0],this.right=arguments[1],this.bottom=arguments[2],this.left=arguments[1];break;case 4:this.top=arguments[0],this.right=arguments[1],this.bottom=arguments[2],this.left=arguments[3]}}function f(a,b,e,f,g,h){switch(arguments.length){case 0:this.origin=new c(0,0),this.size=new d(0,0),this.anchor=new c(0,0);break;case 2:this.origin=new c(a.x,a.y),this.size=new d(b.width,b.height),this.anchor=new c(0,0);break;case 3:this.origin=new c(a.x,a.y),this.size=new d(b.width,b.height),this.anchor=new c(e.x,e.y);break;case 4:this.origin=new c(a,b),this.size=new d(e,f),this.anchor=new c(0,0);break;case 6:this.origin=new c(a,b),this.size=new d(e,f),this.anchor=new c(g,h)}}function g(){this.values=[void 0,void 0],this.indices=[void 0,void 0]}function h(a,b){var c,d,e,f,g,h=void 0===b?-1:b-1,i=a.length,j=this.access;if(void 0===j){for(;++h<i&&!(null!=(c=f=a[h])&&c>=c);)c=f=void 0;for(void 0!==c&&(d=g=h);++h<i;)null!=(e=a[h])&&(c>e&&(c=e,d=h),e>f&&(f=e,g=h))}else{for(;++h<i&&!(null!=(c=f=j.call(a,a[h],h))&&c>=c);)c=void 0;for(void 0!==c&&(d=g=h);++h<i;)null!=(e=j.call(a,a[h],h))&&(c>e&&(c=e,d=h),e>f&&(f=e,g=h))}this.values=[c,f],this.indices=[d,g]}function i(a,b,c,d){switch(arguments.length){case 0:g.call(this),this.access=void 0;break;case 4:this.values=[a,c],this.indices=[b,d];break;default:this.access=b,h.call(this,a,c)}}function j(){i.apply(this,arguments)}function k(a){if(a){var b,c,d=this.access,e=a.length-1;void 0!==d&&(this.access=d),0>e?g.call(this):(b=void 0===d?a[0]:this.access.call(a,a[0],0),c=void 0===d?a[e]:this.access.call(a,a[e],e),this.values=[b,c],this.indices=[0,e])}}function l(a,b,c,d){switch(arguments.length){case 0:g.call(this),this.access=void 0;break;case 4:this.values=[a,c],this.indices=[b,d];break;default:this.access=b,k.call(this,a)}}c.prototype.set=function(a){a&&"object"==typeof a&&(this.x=a.x,this.y=a.y)},c.prototype.distanceX=function(a){return a.x>this.x?a.x-this.x:this.x-a.x},c.prototype.distanceY=function(a){return a.y>this.y?a.y-this.y:this.y-a.y},c.prototype.distance=function(a){var b=this.distanceX(a),c=this.distanceY(a);return Math.sqrt(b*b+c*c)},f.prototype.minX=function(){return this.origin.x-this.size.width*this.anchor.x},f.prototype.maxX=function(){return this.origin.x+this.size.width*(1-this.anchor.x)},f.prototype.midX=function(){return this.origin.x+this.size.width*(1-2*this.anchor.x)/2},f.prototype.minY=function(){return this.origin.y-this.size.height*this.anchor.y},f.prototype.maxY=function(){return this.origin.y+this.size.height*(1-this.anchor.y)},f.prototype.midY=function(){return this.origin.y+this.size.height*(1-2*this.anchor.y)/2},f.prototype.spaceOnTop=function(a){return this.minY()-a.maxY()},f.prototype.spaceOnBottom=function(a){return a.minY()-this.maxY()},f.prototype.roomOnRight=function(a){return a.maxX()-this.maxX()},f.prototype.roomOnBottom=function(a){return a.maxY()-this.maxY()},f.prototype.roomOnLeft=function(a){return this.minX()-a.minX()},f.prototype.roomOnTop=function(a){return this.minY()-a.minY()},f.prototype.translate=function(a){this.origin.x+=a.x,this.origin.y+=a.y},j.prototype.set=h,j.prototype.reset=g,j.prototype.access=function(a){this.access=a},j.prototype.union=function(a,b){var c=!1;if(0===arguments.length)return c;if(Array.isArray(a)){var d=Object.getPrototypeOf(this),e=new d.constructor(a,this.access,b);c=this.union(e)}else if(a instanceof j)(void 0===this.values[0]||a.values[0]<this.values[0])&&(this.values[0]=a.values[0],this.indices[0]=a.indices[0],c=!0),(void 0===this.values[1]||a.values[1]>this.values[1])&&(this.values[1]=a.values[1],this.indices[1]=a.indices[1],c=!0);else{var f=a,g=b;f<this.values[0]&&(this.values[0]=f,this.indices[0]=g,c=!0),f>this.values[1]&&(this.values[1]=f,this.indices[1]=g,c=!0)}return c},j.prototype.shifted=function(a,b){this.indices[0]-=b,this.indices[1]-=b,(isNaN(this.indices[0])||this.indices[0]<0||isNaN(this.indices[1])||this.indices[1]<0)&&this.set(a)},l.prototype=new j,l.prototype.constructor=l,l.prototype.set=k,l.prototype.max=function(a,b){var c,d;return Array.isArray(a)?(d=a.length-1,d>=0&&(c=void 0!==this.access?this.access.call(this,a[d],d):a[d])):a instanceof j?(c=a.values[1],d=a.indices[1]):(c=a,d=b),d>=0&&(void 0===this.values[1]||c>this.values[1])?(this.values[1]=c,this.indices[1]=d,!0):!1},b.Point=c,b.Size=d,b.Margin=e,b.Rect=f,b.ExtentWithIndices=j,b.ExtentWithIndicesSorted=l}(d3,d3.trait),function(a,b){function c(a){return{x:a.xAxis||"x1",y:a.yAxis||"y1"}}function d(a){return a[0]}function e(a){return a[1]}function f(a){return a}function g(a,b){return b}function h(a,b){return{x:a[b.x]||d,y:a[b.y]||e,seriesData:a.seriesData||f,seriesLabel:a.seriesLabel||g}}b.config.axes=c,b.config.accessorsXY=h}(d3,d3.trait),function(a,b){function c(a){if(void 0===a||null===a)return void 0;if(0>=a)return n;var b=n;return b=q>a?p>a?3*o>=a?"1s":12*o>=a?"5s":24*o>=a?"15s":"30s":3*p>=a?"1m":12*p>=a?"5m":24*p>=a?"15m":"30m":r>a?4*q>=a?"1h":9*q>=a?"6h":"12h":6*r>=a?"1d":3*s>=a?"1w":10*t>=a?"1mo":"1y"}function d(b){var d,e;if(d=b.range(),!d)return void 0;if(e=b.invert(d[0]),isNaN(e))return void 0;var f=a.trait.utils.extentMax(d),g=Math.abs(f-d[0]),h=b.invert(f),i=Math.abs(h-e),j=i/g;return c(j)}function e(a,b,c,d,e){this.resolution=a,this.stepSize=w[this.resolution],this.access=b,this.data=d,this.sampled=e,this.extents=void 0,this.constraints={time:c.time,size:c.size},this.throttling={time:c.throttling,last:0,timer:void 0},this.nextResolution={higher:null,lower:null},this.lastRead=Date.now(),this.resampling={nextStep:0,source:void 0,unsampledCount:0},this.onHandlers={update:[]}}function f(){function a(){h={x:function(a){return a[0]},y:function(a){return a[1]}},i={size:0,time:0,throttling:0},j={}}function b(a){var b,c;for(b=a-1;b>=0;b--)if(c=v[b],j.hasOwnProperty(c))return j[c];return null}function c(a){var b,c;for(b=a+1;b<v.length;b++)if(c=v[b],j.hasOwnProperty(c))return j[c];return null}function d(a){var d,e,f=v.indexOf(a.resolution);d=c(f),d&&(a.nextResolution.lower=d,d.nextResolution.higher=a),e=b(f),e&&(a.nextResolution.higher=e,e.nextResolution.lower=a)}function f(){}function g(a){var b=a||n,c=j[b];return void 0===c&&(c=new e(b,h,i),j[b]=c,d(c)),c}var h,i,j;return a(),f.x=function(a){return arguments.length?(h.x=a,this):h.x},f.y=function(a){return arguments.length?(h.y=a,this):h.y},f.constrainSize=function(a){if(!arguments.length)return i.size;if(a>=0){i.size=a;for(var b in j)j[b].constrainSize(i.size)}return this},f.constrainTime=function(a){if(!arguments.length)return i.time;if(a>=0){i.time=a;for(var b in j)j[b].constrainTime(i.time)}return this},f.constrainThrottling=function(a){if(!arguments.length)return i.throttling;if(a>=0){i.throttling=a;for(var b in j)j[b].constrainThrottling(i.throttling)}return this},f.pushPoints=function(a,b,c){var d=g(c);return d.pushPoints(a,b),this},f.get=function(a){var c=a?a.resolution():void 0,d=g(c);if(void 0===d.data){var e=v.indexOf(d.resolution),f=b(e);f&&f.data?d.initialSample(f):(d.data=[],d.resolution!==n&&(f?console.error("murts.get findHigherResolution( "+d.resolution+") -- no data found in source"):console.error("murts.get findHigherResolution( "+d.resolution+") -- no source data found to sample from")))}return d.lastRead=Date.now(),d},f.removeOnUpdate=function(a,b){var c=a.resolution(),d=g(c);d.removeOnUpdate(b)},f.reset=a,f.isMurtsDataStore=function(){return!0},f}function g(a,b,c,d,e,f){var g=a[b],h=f.x(g),i=f.y(g),j={x:[h,h],y:[i,i],d:[g,g]},k={x:h,y:i,count:1};if(h>=d){var l=h-d,m=Math.floor(l/c)+1;d=m*c+d}var n=!0;for(b++;n&&e>b;)g=a[b],h=f.x(g),n=d>h,n&&(i=f.y(g),k.x+=h,k.y+=i,k.count++,i<j.y[0]?(j.x[0]=h,j.y[0]=i,j.d[0]=g):i>j.y[1]&&(j.x[1]=h,j.y[1]=i,j.d[1]=g),b++);return{extents:j,ave:{x:k.x/k.count,y:k.y/k.count,count:k.count},sourceIndex:b,nextStep:d}}function h(a,b,c,d){var e,f,g=d.x(a),h=d.y(a);return e=.5*Math.abs((g-c.ave.x)*(b.extents.y[0]-h)-(g-b.extents.x[0])*(c.ave.y-h)),f=.5*Math.abs((g-c.ave.x)*(b.extents.y[1]-h)-(g-b.extents.x[1])*(c.ave.y-h)),e>f?b.extents.d[0]:b.extents.d[1]}function i(a,c,d){var e,f,g=0,h=[];Date.now();if(0===a.length)return{data:h,nextStep:0};if(e=a[g++],h[0]=e,f=d.x(e)+c,a.length<3)return 2===a.length&&(h[1]=a[g++]),{data:h,nextStep:f,extents:{x:new b.ExtentWithIndicesSorted(h,d.x),y:new b.ExtentWithIndices(h,d.y)}};var i=j(h,a,g,e,c,f,d);return i}function j(a,c,d,e,f,i,j){var k,l,m,n=c.length-1,o={x:new b.ExtentWithIndicesSorted([e],j.x),y:new b.ExtentWithIndices([e],j.y)};for(k=g(c,d,f,i,n,j),d=k.sourceIndex;n>d;d++)i=k.nextStep+f,l=g(c,d,f,i,n,j),d=l.sourceIndex,m=h(e,k,l,j),o.y.union(j.y(m),a.length),a[a.length]=m,e=m,k=l;var p=c[n],q=j.x(p),r=j.y(p);return l={ave:{x:q,y:r,count:1}},m=h(e,k,l,j),o.y.union(j.y(m),a.length),a[a.length]=m,o.y.union(r,a.length),o.x.max(q,a.length),a[a.length]=p,{data:a,extents:o,nextStep:i}}function k(a,c,d,e,f,g){var h=[],i=a.length-c;Date.now();if(1>=i){var k;return 1===i&&(h[0]=a[c++],k={x:new b.ExtentWithIndicesSorted(h,g.x),y:new b.ExtentWithIndices(h,g.y)}),{data:h,nextStep:f,extents:k}}var l=j(h,a,c,d,e,f,g);return l}function l(a){return"function"==typeof a&&a.hasOwnProperty("isMurtsDataStore")&&a.isMurtsDataStore()}function m(a,b){return l(a)?a.get(b).data:a}var n="1s",o=1e3,p=60*o,q=60*p,r=24*q,s=7*r,t=30*r,u=365*r,v=[n,"5s","15s","30s","1m","5m","15m","30m","1h","6h","12h","1d","1w","1mo","1y"],w={"1s":1*o,"5s":5*o,"15s":15*o,"30s":30*o,"1m":1*p,"5m":5*p,"15m":15*p,"30m":30*p,"12h":12*q,"6h":6*q,"1h":1*q,"1d":1*r,"1w":1*s,"1mo":1*t,"1y":1*u+.25*r},x={time:a.time.scale,linear:a.scale.linear,identity:a.scale.identity};a.time.scale=function(){var a,b=x.time(),c=b.range,e=b.rangeRound,f=b.domain;return b.range=function(b){return arguments.length?(c(b),a=void 0,this):c()},b.rangeRound=function(b){return arguments.length?(e(b),a=void 0,this):e()},b.domain=function(b){return arguments.length?(f(b),a=void 0,this):f()},b.resolution=function(c){return arguments.length?(v.indexOf(c)>=0&&(a=c),this):(void 0===a&&(a=d(b)),a)},b},a.scale.linear=function(){var a,b=x.linear(),c=b.range,e=b.rangeRound,f=b.domain;return b.range=function(b){return arguments.length?(c(b),a=void 0,this):c()},b.rangeRound=function(b){return arguments.length?(e(b),a=void 0,this):e()},b.domain=function(b){return arguments.length?(f(b),a=void 0,this):f()},b.resolution=function(c){return arguments.length?(v.indexOf(c)>=0&&(a=c),this):(void 0===a&&(a=d(b)),a)},b},a.scale.identity=function(){var a,b=x.identity(),c=b.range,e=(b.rangeRound,b.domain);return b.range=function(b){return arguments.length?(c(b),a=void 0,this):c()},b.domain=function(b){return arguments.length?(e(b),a=void 0,this):e()},b.resolution=function(c){return arguments.length?(v.indexOf(c)>=0&&(a=c),this):(void 0===a&&(a=d(b)),a)},b};var y=function(){};e.prototype.on=function(a,b){var c,d;this.onHandlers.hasOwnProperty(a)||(this.onHandlers[a]=[]),c=this.onHandlers[a];var e=c.indexOf(b);return 0>e?(c.push(b),d=function(){var a=c.indexOf(b);a>=0&&c.splice(a,1)}):d=y,d},e.prototype.notify=function(a){var b=this;this.onHandlers.update.forEach(function(c){c(a,b.data,b)})},e.prototype.extendNextStepPastExtent=function(){if(this.extents){var a=this.extents.x.values[1];if(a>=this.resampling.nextStep){var b=a-this.resampling.nextStep,c=Math.floor(b/this.stepSize)+1;this.resampling.nextStep+=c*this.stepSize}}},e.prototype.initialSample=function(a){var b=i(a.data,this.stepSize,this.access);this.data=b.data,this.extents=b.extents,this.sampled=!0,this.resampling.nextStep=b.nextStep,this.resampling.source=a,this.resampling.unsampledCount=0,this.data.length>0&&this.extendNextStepPastExtent(),this.applyConstraintsBeforePushPoints()},e.prototype.constrainSize=function(a){a>=0&&(this.constraints.size=a,this.applyConstraintsBeforePushPoints()&&this.notify("constrained"))},e.prototype.constrainTime=function(a){a>=0&&(this.constraints.time=a,this.applyConstraintsBeforePushPoints()&&this.notify("constrained"))},e.prototype.constrainThrottling=function(a){this.throttling.time>=0&&(this.throttling.time=a)},e.prototype.delayConstraints=function(a){if(this.throttling.timer)return!0;if(this.throttling.time>0&&this.throttling.last+this.throttling.time>a){var b=this,c=function(){b.throttling.timer=void 0,b.applyConstraintsBeforePushPoints()&&b.notify("constrained")},d=this.throttling.last+this.throttling.time-a+1;return this.throttling.timer=setTimeout(c,d),!0}return!1},e.prototype.shift=function(a){a>=this.data.length?(this.data=[],this.extents.x.reset(),this.extents.y.reset()):(this.data.splice(0,a),this.extents.x.shifted(this.data,a),this.extents.y.shifted(this.data,a))},e.prototype.applyConstraintsBeforePushPoints=function(b){var c=!1,d=b?b.length:0,e=this.data?this.data.length:0;if(e+d===0)return c;var f=0,g=0,h=Date.now();if(this.constraints.size>0){var i=e+d;if(this.constraints.size<i){if(this.delayConstraints(h))return!1;var j=i-this.constraints.size;f=Math.min(e,j),g=j-f}}if(e>0&&f===e&&(this.shift(f),e=this.data.length,f=0,c=!0),this.constraints.time>0){var k=d>0?this.access.x(b[d-1]):void 0,l=d>0?this.access.x(b[0]):void 0,m=e>0?this.access.x(this.data[e-1]):void 0,n=e>0?this.access.x(this.data[0]):void 0,o=(d>0?k:m)-this.constraints.time;if(o>n||o>l){if(this.delayConstraints(h))return!1;var p,q=a.bisector(this.access.x).left;o>m?f=e:o>n&&(p=Math.min(q(this.data,o,f),e-1),f=Math.max(f,p)),o>l&&(p=Math.min(q(b,o),d-1),g=Math.max(g,p))}}return f>0&&(this.shift(f),c=!0),g>0&&(b.splice(0,g),c=!0),c&&(this.throttling.last=h),c},e.prototype.pushPoints=function(a,c){var d=a.length;if(void 0===this.data&&(this.data=[]),void 0!==c&&(this.sampled=this.sampled||c),d>0){this.applyConstraintsBeforePushPoints(a)&&(d=a.length);var e=this.data.length;this.data=this.data.concat(a),this.extents?(this.extents.x.union(this.data),this.extents.y.union(this.data,e)):this.extents={x:new b.ExtentWithIndicesSorted(this.data,this.access.x),y:new b.ExtentWithIndices(this.data,this.access.y)},this.notify("update"),d>0&&this.nextResolution.lower&&this.nextResolution.lower.sourceUpdated(d)}return this},e.prototype.findIndexOfStepStartFromEnd=function(a,b,c){var d;for(c=void 0===c?0:c,d=a.length-1-c,d=Math.min(d,a.length-1);d>=0&&this.access.x(a[d])>=b;)d--;return d++,Math.max(d,0)},e.prototype.sampleUpdatesFromSource=function(){var a,c=this.resampling.source,d=this.data.length,e=0;if(2>=d)return a=d,this.initialSample(c),{pushedCount:this.data.length,poppedCount:a,initialSample:!0};var f=this.resampling.nextStep-this.stepSize,g=this.findIndexOfStepStartFromEnd(c.data,f,this.resampling.unsampledCount),h=this.findIndexOfStepStartFromEnd(this.data,f),i=d-h;if(this.data.splice(h,i),this.data.length<=2)return a=d,this.initialSample(c),{pushedCount:this.data.length,poppedCount:a,initialSample:!0};var j=this.data[this.data.length-1],l=k(c.data,g,j,this.stepSize,this.resampling.nextStep,this.access);return this.applyConstraintsBeforePushPoints(l.data),e=l.data.length,this.data=this.data.concat(l.data),this.extents&&l.extents?(this.extents.x.union(l.extents.x),this.extents.y.union(l.extents.y)):this.extents={x:new b.ExtentWithIndicesSorted(this.data,this.access.x),y:new b.ExtentWithIndices(this.data,this.access.y)},this.resampling.nextStep=l.nextStep,this.resampling.unsampledCount=0,this.extendNextStepPastExtent(),{pushedCount:e,poppedCount:i,initialSample:!1}},e.prototype.sourceUpdated=function(a,b,c){if(void 0===b&&(b=0),void 0===c&&(c=!1),b+a!==0){var d=this.resampling.source;if(!d)return void console.error("Sampling.sourceUpdated this.resampling.source is unknown: "+d);var e={pushedCount:a,poppedCount:b,initialSample:c};if(this.nextResolution.higher!==d||c)e.poppedCount=this.data.length,this.initialSample(this.nextResolution.higher),e.pushedCount=this.data.length,e.initialSample=!0;else if(this.resampling.unsampledCount+=a-b,d.extents&&d.extents.x.values[1]>=this.resampling.nextStep)e=this.sampleUpdatesFromSource();else{var f=d.data.slice(d.data.length-a);b>0&&this.data.splice(this.data.length-b,b),this.data=this.data.concat(f),this.extents.x.union(d.extents.x),this.extents.y.union(d.extents.y)}e.poppedCount+e.pushedCount>0&&(this.notify("update"),this.nextResolution.lower&&this.nextResolution.lower.sourceUpdated(e.pushedCount,e.poppedCount,e.initialSample))}},b.murts={dataStore:f,utils:{Sampling:e,sample:i,sampleUpdates:k,mapResolution:c,isDataStore:l,getOrElse:m}}}(d3,d3.trait),function(a,b){function c(b,c,d){if(!b)return 0;var e=a.trait.utils.extentMax(c),f=a.trait.utils.extentMin(c),g=d(b),h=d(f);return h>g?0:g-d(e)}function d(a,b){a.selectAll("path").attr("d",b).attr("transform",null)}function e(b,e,f,g,i,j){var k=f.domain(),l=a.trait.utils.extentMax(k),m=function(b){a.select(this).attr("transform",null).selectAll("path").datum(b).attr("d",i)};if("trend"===b){var n=c(j,k,f);-1.5>n?(g.each(m),0!==e&&e?(h&&console.log("updatePathWithTrend trend translateX: "+n+", transition yes,  duration: "+e),g.transition().duration(e).ease("linear").attr("transform","translate("+n+")")):(h&&console.log("updatePathWithTrend trend translateX: "+n+", transition none, duration: "+e),g.attr("transform","translate("+n+")"))):(h&&console.log("updatePathWithTrend trend translateX: "+n+" < 1.5, so simplePathRedraw"),d(g,i))}else d(g,i);return l}function f(a,b,c,d){var e=d.range(),f=e[e.length-1]-e[0],g=a.length;if(2>g||b.length<2)return f;var h=b[0],i=Math.min(g-1,b[1]);if(0>h||h>=g)return f;var j,k=d(c(a[h],h));for(h++;i>=h;h++)j=d(c(a[h],h)),f=Math.min(f,j-k),k=j;return f}function g(b,c,d){if(b.length<=0)return null;var e=a.trait.utils.extentMin(d),f=a.trait.utils.extentMax(d),g=a.bisector(c),h=g.left,i=g.right,j=h(b,e),k=i(b,f);return[j,k-1]}var h=!1;b.chart.utils.updatePathWithTrend=e,b.chart.utils.minDistanceBetween=f,b.chart.utils.dataIndicesExtentForDomainExtent=g}(d3,d3.trait),function(a,b){function c(b){var c={distance:14,axis:null};return b.focus&&(c.distance=a.trait.utils.configFloat(b.focus.distance,c.distance),c.axis=b.focus.axis),c}function d(b,c,d,e,f){return new a.trait.Point(e(d.x(b,c)),f(d.y(b)))}function e(b,c,d,e,f){return new a.trait.Point(e(d.x(b,c)),f(b.y0+d.y(b)))}function f(a,b,c,d,e,f,g,h){var i,j,k=b[c],l=g(k,c,d,e,f);return i=l.distance(h),j=l.distanceX(h),{series:a,index:c,item:k,point:l,distance:i,distanceX:j}}function g(a,b){var c="x"===b.axis?a.distanceX:a.distance;return c<=b.distance}function h(c,h,i,j,k,l,m,n){var o=[],p=new a.trait.Point(k.invert(h.x),l.invert(h.y)),q=a.bisector(j.x).left,r=n?e:d;return c.forEach(function(a,c,d){var e,n,s,t=b.murts.utils.getOrElse(j.seriesData(a),k);if(t.length>0){if(s=q(t,p.x),s>=t.length&&(s=t.length-1),e=f(a,t,s,j,k,l,r,h),n=e.index-1,n>=0){var u=f(a,t,n,j,k,l,r,h);"x"===i.axis?u.distanceX<e.distanceX&&(e=u):u.distance<e.distance&&(e=u)}g(e,i)&&(e.color=m(a),o.push(e))}}),o}b.focus||(b.focus={}),b.focus.utils={makeConfig:c,getFocusItems:h}}(d3,d3.trait),function(a,b){function c(a,b){return a.rect.origin.y-b.rect.origin.y}function d(a,b){for(var c=null,d=a.length-1;d>=0;d--){var e,f=a[d],g=f.rect;e=d===a.length-1?b-g.maxY():c.rect.spaceOnTop(g),0>e&&(g.origin.y+=e),c=f}}function e(a,b,c){var d=0;c>0?d=-c-b:0>b&&(d=-b),a.origin.y+=d}function f(a,b,c){var d,f=null;a.forEach(function(a,g,h){d=a.rect,0===g?e(d,d.roomOnTop(b),c):e(d,d.spaceOnTop(f.rect),c),f=a})}function g(a,b,c,d){for(var e,f=b;c>f;f++)e=a[f],e.rect.origin.y+=d}function h(a,b,c){for(var d,e,f,h,i=0,j=0,k=0,l=0,m=null,n=0,o=0;i<a.length;i++){if(f=a[i],d=f.rect,e=0===i?d.roomOnTop(b):d.spaceOnTop(m.rect),h=d.origin.y-c[i],o=k>0?n/k:n,e>0||k>0&&o>0&&0>=h)if(k>0){if(o=n/k,-1>o||o>1){var p=o;o=o>0?Math.min(o,l):-Math.min(-o,e),g(a,j,i,-o),l-=o,e+=o,e>0?(k=1,j=i,l=e,n=0):(n=(p-o)*k,k++,n+=d.origin.y-c[i])}}else k=1,j=i,l=e,n+=d.origin.y-c[i];else k++,n+=d.origin.y-c[i];m=f}if(k>1&&(o=n/k,-1>o||o>1)){if(o>0)o=Math.min(o,l);else{var q=m.rect.roomOnBottom(b);o=q>0?-Math.min(-o,q):0}g(a,j,i,-o)}}function i(b,e){if(!(b.length<=0)){b.sort(c);var g=0,i=0,j=e.size.height,k=a.sum(b,function(a){return a.rect.size.height}),l=b.map(function(a){return a.rect.origin.y});k>j?i=(k-j)/b.length:g=j-k,f(b,e,i),g>0&&(d(b,e.maxY()),h(b,e,l))}}function j(a,b){var c,d=[],e=[];return a.forEach(function(a,f,g){c=a.rect,c.anchor.x<.5?c.roomOnRight(b)>=0?(a.orient=q,e.push(a)):(a.orient=p,c.anchor.x=1,d.push(a)):c.roomOnLeft(b)>=0?(a.orient=p,d.push(a)):(a.orient=q,c.anchor.x=0,e.push(a))}),[d,e]}function k(a,b){var c=j(a,b);i(c[0],b),i(c[1],b)}function l(a,b,c,d){var e,f,g=0;switch(c){case"left":g=b.minX(),a.forEach(function(a,b,c){e=a.rect,e.origin.x+=g-e.minX(),g=e.maxX()});break;case"right":for(g=b.maxX(),f=a.length-1;f>=0;f--)e=a[f].rect,e.origin.x+=g-e.maxX(),g=e.minX();break;case"top":g=b.minY(),a.forEach(function(a,b,c){e=a.rect,e.origin.y+=g-e.minY(),g=e.maxY()});break;case"bottom":for(g=b.maxY(),f=a.length-1;f>=0;f--)e=a[f].rect,e.origin.y+=g-e.maxY(),g=e.minY()}}function m(a){for(var b=-1,c=a.length,d=[];++b<c;)d[b]=[];return d}function n(a){for(var b,c,d,e=-1,f=a.length,g=Number.MAX_VALUE;++e<f;)b=a[e],d=b.peekNextX(),void 0!==d&&g>d&&(c=e,g=d);return c}function o(a){var b=a.length;if(!b)return[];var c,d,e,f,g=m(a);for(d=0,e=n(a);void 0!==e;){for(f=a[e].peekNextX(),c=-1;++c<b;)g[c][d]=a[c].next(f);e=n(a),d++}return g}var p=-1,q=1;b.layout.adjustOrientationToFitWidth=j,b.layout.vertical=i,b.layout.byOrientation=l,b.layout.verticalAnchorLeftRight=k,b.layout.mapUniform=o,b.layout.utils={listNudgeUpFromBottom:d,removeOverlapFromTop:f,listBalanceFromTop:h,trendstack:{makeTargetSeries:m,seriesIndexOfMinNextX:n}}}(d3,d3.trait),function(a,b){function c(a,b,c){return e(a,b,b.value,c)}function d(a,b,c){return e(a,b,q,c)}function e(b,c,d,e){var f=a.min(b,function(a,b,e){return i(c.series(a,b,e),c,d)});return f||(f=e?e:0),f}function f(a,b,c){return h(a,b,b.value,c)}function g(a,b,c){var d=function(a){return a.y0+b.value(a)};return h(a,b,d,c)}function h(b,c,d,e){var f=a.max(b,function(a,b,e){return j(c.series(a,b,e),c,d)});return f||(f=e?e:0),f}function i(c,d,e){if(b.murts.utils.isDataStore(c)){var f=c.get();return void 0===f.extents?void 0:"x"===d.axisChar?f.extents.x.values[0]:f.extents.y.values[0]}return a.min(c,e)}function j(c,d,e){if(b.murts.utils.isDataStore(c)){var f=c.get();return void 0===f.extents?void 0:"x"===d.axisChar?f.extents.x.values[1]:f.extents.y.values[1]}return a.max(c,e)}function k(a,b,c,d){var e=a.map(function(a){return l(b.series(a),b)});return n(e,c,d)}function l(c,d){if(b.murts.utils.isDataStore(c)){var e=c.get();return void 0===e.extents?[void 0,void 0]:"x"===d.axisChar?e.extents.x.values:e.extents.y.values}return a.extent(c,d.value)}function m(b,c,d,e){var f;return f=b.map(function(b,d){var e=c.series(b,d),f=[a.min(e,function(a){return a.y0}),a.max(e,function(a,b){return a.y0+c.data(a,b)})];return f}),n(f,d,e)}function n(b,c,d){var e,f;if(e=a.min(b,function(a){return a[0]}),f=a.max(b,function(a){return a[1]}),!e&&!f)return d?d:[0,1];if(!(e instanceof Date||f instanceof Date||isNaN(e)||isNaN(f)))if(e===f)e-=1,f+=1;else{var g=(f-e)*c;e-=g,f+=g}return[e,f]}function o(a,c){return!a||a.length<2?!0:c[0]<a[0]||b.utils.extentMax(c)>b.utils.extentMax(a)}function p(a,c){return!c||c.length<2?a:!a||a.length<2?c:(c[0]<a[0]&&(a[0]=c[0]),b.utils.extentMax(c)>b.utils.extentMax(a)&&(a[a.length-1]=b.utils.extentMax(c)),a)}var q=function(a){return a.y0};b.utils||(b.utils={}),b.utils.minFromData=c,b.utils.maxFromData=f,b.utils.minFromAreaData=d,b.utils.maxFromAreaData=g,b.utils.extentFromData=k,b.utils.extentFromAreaData=m,b.utils.isExtentExtended=o,b.utils.extendExtent=p}(d3,d3.trait),function(a,b){function c(a,b){return b?b:"x"===a?"bottom":"left"}function d(a){var b=a.axis,d=b.charAt(0),e={name:b,axisChar:d,accessData:a[b],orient:c(d,a.orient),ticks:a.ticks,extentTicks:a.extentTicks||!1,tickSize:a.tickSize,tickPadding:a.tickPadding,tickFormat:a.tickFormat,nice:a.nice,label:a.label,lines:a.lines,gridLines:a.gridLines};return e.labelLineHeight=e.label?a.labelLineHeight||14:0,e.axisMargin=a.axisMargin||40+e.labelLineHeight,e}function e(a,b,c){if(!b.label)return null;var d,e,f=c.node().getBBox(),g=Math.round(f.width/2);b.axisMargin-b.labelLineHeight;switch(b.orient){case"left":return d=-b.axisMargin+b.labelLineHeight,e=a.chartHeight()/2+g,"translate( "+d+","+e+") rotate( -90)";case"bottom":return d=a.chartWidth()/2-g,e=b.axisMargin-b.labelLineHeight,"translate( "+d+","+e+")";case"top":return d=a.chartWidth()/2-g,e=-b.axisMargin+b.labelLineHeight,"translate( "+d+","+e+")";case"right":return d=b.axisMargin-b.labelLineHeight,e=a.chartHeight()/2-g,"translate( "+d+","+e+") rotate( 90)";default:return null}}function f(a,b,c,d,e){d.extentTicks?b.tickValues(c.domain()):d.ticks&&b.ticks(d.ticks),d.gridLines?g(a,b,d,e):d.tickSize&&b.tickSize(d.tickSize),d.tickPadding&&b.tickPadding(d.tickPadding),d.tickFormat&&b.tickFormat(d.tickFormat)}function g(a,b,c,d){switch(a.classed("grid",c.gridLines),c.axisChar){case"x":b.tickSize(-d.chartHeight());break;case"y":b.tickSize(-d.chartWidth())}}function h(a){return"object"==typeof a&&a.hasOwnProperty("class")?l+" "+a["class"]:l}function i(b,c){function g(a){var c=isNaN(a)?a.value:a,d=p(c);return"x"===o.axisChar?"M"+d+",0L"+d+","+b.chartHeight():"M0,"+d+"L"+b.chartWidth()+","+d}function i(c){var d=i;c.each(function(c){if(j||(j=this._container.append("g").classed("axis",!0).classed("axis-"+o.name,!0),o.label&&(m=j.append("text").classed("axis-label axis-label-"+o.name,!0)),n=a.svg.axis().scale(p)),k&&console.log("axisLinear.each "+o.name),n.orient(o.orient),f(j,n,p,o,d),d.layoutAxis(o.name,j,o.orient,o.axisMargin),o.label&&(m.text(o.label),m.attr({transform:e(d,o,m)})),j.call(n),b.isMinRangeMargin(o.name)){var i=a.trait.utils.getScaleExtensions(b,o.name,p),q=j.selectAll("path.axis-extension").data(i);q.enter().append("path").attr("class","axis-extension").attr("d",function(a){return"M"+a[0]+",0L"+a[1]+",0"}),q.transition().duration(0).attr("class","axis-extension").attr("d",function(a){return"M"+a[0]+",0L"+a[1]+",0"})}if(o.lines&&Array.isArray(o.lines)){var r=j.selectAll("path."+l).data(o.lines);r.enter().append("path").attr("class",h).attr("d",g)}})}var j,m,n,o=d(c),p=b[o.name]();return i.update=function(a,c){return this._super(a,c),k&&console.log("axisLinear.update "+o.name),f(j,n,p,o,this),0===c?(j.call(n),o.lines&&Array.isArray(o.lines)&&j.selectAll("path."+l).attr("d",g)):(j.transition().duration(c||b.duration()).ease("linear").call(n),o.lines&&Array.isArray(o.lines)&&j.selectAll("path."+l).duration(c||b.duration()).attr("d",g)),this},b.onRangeMarginChanged("axisLinear-"+o.name,i),i}function j(b,c){function g(b){var d=g;b.each(function(b){i||(i=this._container.append("g").classed("axis",!0).classed("axis-"+n.name,!0),
n.label&&(j=i.append("text").classed("axis-label axis-label-"+n.name,!0)),l=a.svg.axis());var g=o.domain();m.range(o.range()),m.domain(o.domain()),n.nice&&m.nice(n.nice),l.scale(m).orient(n.orient),f(i,l,m,n,d),d.layoutAxis(n.name,i,n.orient,n.axisMargin),n.label&&(j.text(n.label),j.attr({transform:e(d,n,j)})),i.call(l);var h=i.selectAll("path.axis-extension").data(a.trait.utils.isValidDate(g[0])?[g[0]]:[]);h.transition().attr("class","axis-extension").attr("d",function(a){return"M0,0L"+m(a)+",0"}),h.enter().append("path").attr("class","axis-extension").attr("d",function(a){return"M0,0L"+m(a)+",0"}),a.trait.utils.isData(b,c.seriesData)&&(k=a.trait.utils.extentMax(g))})}function h(){var b=o.domain(),c=a.trait.utils.extentMin(b),d=a.trait.utils.extentMax(b);if(k){var e=k.getTime();if(e>c.getTime()){var f=d.getTime()-e;c=new Date(c.getTime()+f)}}return[c,d]}var i,j,k,l=a.svg.axis(),m=a.time.scale(),n=d(c),o=b[n.name]();return g.update=function(c,d){this._super(c,d),m.range(a.trait.utils.getScaleRange(b,n.name));var e=h();return m.domain(e),k=a.trait.utils.extentMax(e),0===d?i.call(l):i.transition().duration(d||b.duration()).ease("linear").call(l),this},b.onChartResized("axisMonth-"+n.name,g),b.onRangeMarginChanged("axisMonth-"+n.name,g),g}var k=!1,l="axis-line";b.axis.linear=i,b.axis.time||(b.axis.time={}),b.axis.time.month=j}(d3,d3.trait),function(a,b){function c(b,c,d,e,f){var g,h,i,j;return i=function(a){return e(a.y0)},h=function(a){return d(c.actualX(a))},j=b?function(a){return e(a.y0+c.actualY(a))}:function(a){return e(c.actualY(a))},g=a.svg.area().interpolate(f||"linear").x(h).y1(j),b&&g.y0(i),g}function d(a){return"object"==typeof a?{interpolate:a.interpolate||g,out:a.out,epsilon:a.epsilon}:{interpolate:g}}function e(e,g){function i(a){return a._resampledData}function j(a,c){return f&&console.log("******* oneSeriesData( d) "+w.seriesLabel(a,c)),b.murts.utils.getOrElse(w.seriesData(a,c),x)}function k(a,b){f&&console.log("******* makeAreaAttrD( d)");var c=w.actualValues(a,b);return r(c)}function l(a){if(E.interpolate===h){var b,c=a.map(j);for(c=u(c),b=0;b<a.length;b++)a[b]._resampledData=c[b]}}function m(b){a.select(this).selectAll("path").datum(b).attr("d",k)}function n(b){var c=n;b.each(function(b){if(f&&console.log("******* begin selection.each"),!o){var d=g.chartClass?"chart-area "+g.chartClass:"chart-area";o=this._chartGroup.append("g").classed(d,!0)}q=H(b),f&&console.log("******* before stackLayout( filteredData)"),F?(q.length>0&&!A&&(f&&console.log("******* stackLayout( filteredData)"),l(q),t(q)),A=!1):(l(q),r.y0(c.chartHeight())),p=o.selectAll(".series").data(q),p.transition().duration(500).each(m),p.enter().append("g").attr("class","series").append("path").attr("class","area").attr("d",k).style("fill",c.color),s=a.trait.utils.extentMax(x.domain()),f&&console.log("******* end selection.each")})}var o,p,q,r,s,t,u,v=b.config.axes(g),w=b.config.accessorsXY(g,v),x=e[v.x](),y=e[v.y](),z=v.y+"ExtendDomain",A=!1,B=a.trait.utils.configFloat(g.domainPadding,0),C=a.trait.focus.utils.makeConfig(g),D=g.interpolate||"linear",E=d(g.resample),F=g.stacked===!0,G={},H=g.seriesFilter?function(a){return a.filter(g.seriesFilter)}:function(a){return a};"true"===g.stacked&&console.error("chart.area config stacked:'true' should not have quotes. Ignored."),E.interpolate===h?(w.actualValues=i,w.actualX=function(a){return a.x},w.actualY=function(a){return a.y}):(w.actualValues=j,w.actualX=w.x,w.actualY=w.y),G.series=w.actualValues,G.data=w.actualY,r=c(F,w,x,y,D,e.chartHeight()),function(a){var b=a.map(j);return E.interpolate===h&&(b=u(b)),b},E.interpolate===h&&(u=b.layout.uniformInterpolator().x(w.x).y(w.y),void 0!==E.epsilon&&u.epsilon(E.epsilon)),F&&(t=a.layout.stack().values(w.actualValues).x(w.actualX).y(w.actualY));var I=a.dispatch("customHover");return n[z]=function(a,c){if(a=this._super(a,c),A=!0,f&&console.log("chartArea."+z+": begin"),!F)return a;if(c&&(q=H(c)),0===q.length)return a;f&&console.log("chartArea."+z+": before processFilteredData"),l(q),f&&console.log("chartArea."+z+": before stackLayout"),t(q);var d=b.utils.extentFromAreaData(q,G,B);return f&&console.log("chartArea."+z+": domain: "+JSON.stringify(a)+" data extent: "+JSON.stringify(d)),b.utils.extendExtent(a,d),a},n.update=function(a,c){this._super(a,c),f&&console.log("------- chartArea.update begin");var d=c||e.duration();if(F){f&&console.log("------- chartArea.update stackLayout( filteredData)"),l(q),q.length>0&&t(q),p=o.selectAll(".series").data(q),f&&console.log("------- chartArea.update extentFromAreaData");b.utils.extentFromAreaData(q,G,B)}return f&&console.log("------- chartArea.update updatePathWithTrend"),s=b.chart.utils.updatePathWithTrend(a,d,x,p,k,s),this},n.getFocusItems=function(a){var c=this._super(a),d=b.focus.utils.getFocusItems(q,a,C,w,x,y,n.color,F);return c=c.concat(d)},a.rebind(n,I,"on"),n}var f=!1,g="none",h="uniform-x";b.chart.area=e}(d3,d3.trait),function(a,b){function c(b,c){"true"===b.stacked&&console.error("chart.bar config stacked:'true' should not have quotes. Ignored.");var d=void 0!==b.justification?b.justification:null!==c&&"function"==typeof c&&c.rangeBand?"left":"center",e=c.rangeBand?0:.1,f=a.trait.utils.configFloat(b.gap,e),g=a.trait.utils.configFloat(b.outerGap,f),h={width:b.width||"auto",gap:f,outerGap:g,justification:d,insets:b.insets||m,stacked:b.stacked===!0};return h}function d(a,b,c,d,e,f){function g(c,e){return d(a.x(c,e))+b.offset}function h(b,c){return e(Math.max(a.y(b,c),0))}function i(a,b){return e(a.y0)}function j(b,c){return e(0)-e(Math.abs(a.y(b,c)))}function k(a,b){return e(0)-e(a.size)}return{x:g,y:f?i:h,width:b.width,height:f?k:j}}function e(a,b,c){var d=0;switch(a){case"left":d=Math.round(c/2);break;case"right":d=Math.round(0-b-c/2);break;default:d=0-Math.round(b/2)}return d}function f(a,b,c,d,f,g,h,i){var j,k,l,m=e(i,f,g)-h,n=e(i,f,g)+f+h;return b?(j=b[0],k=d(c(a[j],j))+m,j=b[1],l=d(c(a[j],j))+n,[Math.floor(k),Math.ceil(l)]):d.range()}function g(b,c,d,e,g,h,i,j,k){var l=b.map(function(a,b){return f(d(a),c[b],e,g,h,i,j,k)}),m=a.min(l,function(a,b){return a[0]}),n=a.min(l,function(a,b){return a[1]});return[m,n]}function h(c,d,f,h,i,j){var n,o=null,p=null,q=0,r=0;if(i.rangeBand)n="auto"===h.width?i.rangeBand():h.width,k&&console.log("getBarDimmensions scale.rangeBand width "+n+", domain "+JSON.stringify(i.domain())+", range "+JSON.stringify(i.range()));else{var s=i.domain(),t=c.map(function(a){return b.chart.utils.dataIndicesExtentForDomainExtent(d(a),f,s)}),u=a.min(c,function(a,c){return b.chart.utils.minDistanceBetween(d(a),t[c],f,i)});n="auto"===h.width?Math.max(1,Math.floor(u*(1-h.gap))):h.width,q=Math.round(n*h.gap),r=Math.floor(n*h.outerGap);var v=g(c,t,d,f,i,n,q,r,h.justification),w=v[0],x=v[1];if(0>w||x>j)if(h.insets===m){var y=Math.max(x,j)-Math.min(0,w),z=j/y;"auto"===h.width&&(n=Math.max(1,Math.floor(n*z)),q=Math.round(n*h.gap),r=Math.floor(n*h.outerGap)),h.insets===m&&(v=g(c,t,d,f,i,n,q,r,h.justification),w=v[0],x=v[1],(0>w||x>j)&&(o={},0>w&&(o.left=1-w),x>j&&(o.right=x-j)))}else if(h.insets===l){var A=0>w?i.invert(w):s[0],B=x>j?i.invert(x):s[s.length-1];p=[A,B]}}var C=e(h.justification,n,q);return{width:n,gap:q,outerGap:r,offset:C,domainExtent:p,minRangeMargin:o}}function i(b,c){for(var d=c.seriesData(b[0]).length;d--;){var e,f,g,h=b.length,i=0,j=0;for(f=0;h>f;f++)e=c.seriesData(b[f]),e=e[d],g=c.y(e),e.size=Math.abs(g),0>g?(e.y0=j,j-=e.size):e.y0=i+=e.size}b.extent=a.extent(a.merge(a.merge(b.map(function(a){return c.seriesData(a).map(function(a){return[a.y0,a.y0-a.size]})}))))}function j(e,f){function g(b){var c=g;b.each(function(b){function g(a,b,d){return c.color(m[d])}var q=e.chartWidth();if(k&&console.log("chartBar._selection.each begin -------------------------------"),m=y(b),o=h(m,r.seriesData,r.x,w,s,q),(o.minRangeMargin||o.domainExtent)&&(o.minRangeMargin?c.minRangeMargin("x1",o.minRangeMargin):o.domainExtent&&e.x1Domain(o.domainExtent),o=h(m,r.seriesData,r.x,w,s,q)),!j){var u=f.chartClass?"chart-bar "+f.chartClass:"chart-bar";j=this._chartGroup.append("g").classed(u,!0)}w.stacked&&i(m,r),l=j.selectAll(".series").data(m),l.enter().append("g").attr("class","series").style("fill",c.color),n=l.selectAll("rect").data(r.seriesData),n.enter().append("rect").classed("bar",!0).attr(d(r,o,c.chartHeight(),s,t,w.stacked)).style("fill",g).on("mouseover",v.customHover),n.transition().duration(0).delay(0).ease(c.ease()).attr(d(r,o,c.chartHeight(),s,t,w.stacked)),n.exit().transition().style({opacity:0}).remove(),p=a.trait.utils.extentMax(s.domain())})}var j,l,m,n,o,p,q=b.config.axes(f),r=b.config.accessorsXY(f,q),s=e[q.x](),t=e[q.y](),u=q.y+"ExtendDomain",v=a.dispatch("customHover"),w=c(f,s),x=a.trait.focus.utils.makeConfig(f),y=("function"==typeof s.rangeBand,f.seriesFilter?function(a){return a.filter(f.seriesFilter)}:function(a){return a});return g[u]=function(a,b){return a=this._super(a,b),k&&console.log("chartBar[yExtendDomainKey] begin ********************************"),k&&console.log("chartBar."+u+": begin"),w.stacked?(b&&(m=y(b)),0===m.length?a:(k&&console.log("chartBar."+u+": before stackLayout"),i(m,r),m.extent)):a},g.update=function(b,c){this._super(b,c),k&&console.log("chartBar.update begin ++++++++++++++++++++++++++++++++");var f=e.chartWidth();k&&console.log("chartBar.update x1.domain "+JSON.stringify(s.domain())+", range "+JSON.stringify(s.range()));var g=a.trait.utils.extentMax(s.domain()),i=void 0!==p&&void 0!==g?s(p)-s(g):0;return o=h(m,r.seriesData,r.x,w,s,f),l.attr("transform",null),n=l.selectAll("rect").data(r.seriesData),n.attr(d(r,o,e.chartHeight(),s,t,w.stacked)),n.enter().append("rect").classed("bar",!0).attr(d(r,o,e.chartHeight(),s,t,w.stacked)),n.exit().transition().duration(c).style({opacity:0}).remove(),0===c?l.attr("transform","translate("+i+")"):l.transition().duration(c||e.duration()).ease("linear").attr("transform","translate("+i+")"),p=a.trait.utils.extentMax(s.domain()),this},g.getFocusItems=function(a){var c=this._super(a),d=b.focus.utils.getFocusItems(m,a,x,r,s,t,g.color,w.stacked);return c=c.concat(d)},a.rebind(g,v,"on"),g}var k=!1,l="extend-domain",m="inset-range";b.chart.bar=j,b.chart.barUtils={barConfig:c,barAttr:d,barOffsetForJustification:e,rangeExtentOfBarsAndOuterGapForOneSeries:f,rangeExtentOfBarsAndOuterGap:g,getBarDimensions:h}}(d3,d3.trait),function(a,b){function c(c,f){function g(a){O[a]||(O[a]=b.utils.clone(Q))}function h(b){if(!O[b])return!1;var c=O[b];return a.trait.utils.isX(b)?0!==c.left||0!==c.right:0!==c.top||0!==c.bottom}function i(a,b){if(!arguments.length)return{};if(g(a),1===arguments.length)return O[a];if(!b)return this;var c=O[a],d=!1;return b.left&&c.left<b.left&&(c.left=b.left,d=!0),b.right&&c.right<b.right&&(c.right=b.right,d=!0),b.top&&c.top<b.top&&(c.top=b.top,d=!0),b.bottom&&c.bottom<b.bottom&&(c.bottom=b.bottom,d=!0),d&&fa.rangeMarginChanged(),this}function j(){return f.colors?Array.isArray(f.colors)?function(a){return f.colors[a]}:f.colors:a.scale.category10()}function k(){var b=new a.trait.Size(200,100);return f.size&&(f.size.width&&(b.width=f.size.width,U.width=!1),f.size.height&&(b.height=f.size.height,U.height=!1)),b}function l(a,b){var c="chart-group-clip-path-"+d;return a._chartGroupClipPath=b.append("clipPath").attr("id",c),a._chartGroupClipPathRect=a._chartGroupClipPath.append("rect").attr("width",X).attr("height",Y),d++,c}function m(a,b,c){return a.x>=0&&a.x<=b&&a.y>=0&&a.y<=c}function n(a,b,c,d,e,f){var g;c&&x(a,[b],d),g=c?u.getFocusItems.call(a,b):[],g.forEach(function(a){a.point.x+=N.left,a.point.y+=N.top}),v(a,g)&&w(a,[g,b],d),a.__onFocusChangeLastFoci=g}function o(a,b){y(a,b)}function p(a,b,c){return a?c:b}function q(a,b,c,d){return a?d.indexOf("%")>=0?d:c:b}function r(a,b,c){var d={};return d.width=q(b.width,c.width,a.offsetWidth,a.style.width),d.height=q(b.height,c.height,a.offsetHeight,a.style.height),d}function s(b,c,d){return new a.trait.Size(p(c.width,d.width,b.offsetWidth),p(c.height,d.height,b.offsetHeight))}function t(a){W=s(a,U,W),X=Math.max(0,W.width-N.left-N.right),Y=Math.max(0,W.height-N.top-N.bottom)}function u(b){T=b,b.each(function(b){var c=this,d=r(c,U,W);if(S=a.select(c),c._svg)t(c);else{c._svg=a.select(c).append("svg").classed("chart",!0).attr("width",d.width).attr("height",d.height),c._svgDefs=c._svg.append("defs"),t(c);var e=null;f.clip&&(e=l(c,c._svgDefs)),c._container=c._svg.append("g").classed("container-group",!0),c._chartGroup=c._container.append("g").classed("chart-group",!0),f.clip&&c._chartGroup.attr("clip-path","url(#"+e+")"),this._svg.on("mousemove",function(){var b=a.mouse(c._chartGroup.node()),d=new a.trait.Point(b[0],b[1]),e=m(d,X,Y);n(c,d,e,!0,N.left,N.top)}),this._svg.on("mouseout",function(){var b=a.mouse(c._chartGroup.node()),d=new a.trait.Point(b[0],b[1]),e=m(d,X,Y);e||o(c,!0)}),_=[],b.forEach(function(a){var b;a.__color__&&(b=_.indexOf(a.__color__),b>=0?delete a.__color__:_.push(a.__color__))})}c._svg.transition().duration(ca).attr({width:W.width,height:W.height}),c._svg.select(".chart-group").attr("transform","translate("+N.left+","+N.top+")"),f.clip&&c._chartGroupClipPathRect.attr("width",X).attr("height",Y),ca=500})}function v(a,b){var c=a.__onFocusChangeLastFoci;if(!c||c.length!==b.length)return!0;for(var d,e,f=c.length-1;f>=0;f--)if(d=c[f],e=b[f],d.index!==e.index||d.point.x!==e.point.x||d.point.y!==e.point.y)return!0;return!1}function w(a,b,c){z(a,"__onFocusChangeListeners",b),c&&z(aa,"__onFocusChangeListeners",b)}function x(a,b,c){z(a,"__onChartMouseMoveListeners",b),c&&z(aa,"__onChartMouseMoveListeners",b)}function y(a,b){z(a,"__onChartMouseOutListeners",[]),b&&z(aa,"__onChartMouseOutListeners",[])}function z(a,b,c){if(a[b])for(var d,e=0,f=a[b],g=f.length;g>e;e++)d=f[e],d.apply(a,c)}function A(a,b,c,d){var e=c===!1||d===!1;if(!b)return!1;var f=void 0===c||c===!1?aa:c;if(!f[a]){if(e)return!1;f[a]=[]}if(e){var g=f[a];if(g){var h=g.indexOf(b);h>=0&&g.splice(h,1)}return!1}return f[a].push(b),!0}function B(){var a={chartWidth:X,chartHeight:Y};X=Math.max(0,W.width-N.left-N.right),Y=Math.max(0,W.height-N.top-N.bottom),e.resize&&console.log("chartBase.updateChartSize() chartWidth "+a.chartWidth+"->"+X+", chartHeight "+a.chartHeight+"->"+Y+" selection:"+!!T),(a.chartWidth!==X||a.chartHeight!==Y)&&(T&&u.callTraits(T),fa.chartResized())}function C(){var a={width:W.width,height:W.height};W.width=X+N.left+N.right,W.height=Y+N.top+N.bottom,(a.width!==W.width||a.height!==W.height)&&fa.chartResized()}function D(a){var b,c,d=P.length;for(b=0;d>b;b++)if(c=P[b],c.group===a)return c;return null}function E(a,b){var c,d=!1;if(a.length<=0)return d;switch(b){case"left":c=a[a.length-1].rect.maxX(),N.left<c&&(N.left=c,d=!0);break;case"right":c=W.width-a[0].rect.minX(),N.right<c&&(N.right=c,d=!0);break;case"top":c=a[a.length-1].rect.maxY(),N.top<c&&(N.top=c,d=!0);break;case"bottom":c=W.height-a[0].rect.minY(),N.bottom<c&&(N.bottom=c,d=!0)}return d}function F(a){var b=!1;return a.forEach(function(a){a.rect.minY()<N.top&&(a.rect.origin.y=N.top,b=!0)}),b}function G(a){var b=!1;return a.forEach(function(a){a.rect.minX()<N.left&&(a.rect.origin.x=N.left,b=!0)}),b}function H(a,b){var c=!1,d=0,e=0;if(a.length<=0)return c;switch(b){case"left":c=F(a),d=a[a.length-1].rect.maxX(),d<N.left&&(e=N.left-d,a.forEach(function(a){a.rect.origin.x+=e}),c=!0);break;case"right":c=F(a),d=a[0].rect.minX(),d>W.width-N.right&&(e=W.width-N.right-d,a.forEach(function(a){a.rect.origin.x+=e}),c=!0);break;case"top":c=G(a),d=a[a.length-1].rect.maxY(),d<N.top&&(e=N.top-d,a.forEach(function(a){a.rect.origin.y+=e}),c=!0);break;case"bottom":c=G(a),d=a[0].rect.minY(),d>W.height-N.bottom&&(e=W.height-N.bottom-d,a.forEach(function(a){a.rect.origin.y+=e}),c=!0)}return c}function I(b,c){switch(b){case"left":return new a.trait.Rect(0,0,c,0,1,0);case"right":return new a.trait.Rect(0,0,c,0);case"top":return new a.trait.Rect(0,0,0,c,0,1);case"bottom":return new a.trait.Rect(0,0,0,c);default:return new a.trait.Rect}}function J(){var b,c,d=!1,e=new a.trait.Rect(0,0,W.width,W.height),f=["left","right","top","bottom"],g={};f.forEach(function(c){b=P.filter(function(a){return a.orient===c}),a.trait.layout.byOrientation(b,e,c),d=d||E(b,c),g[c]=b});for(c in g)b=g[c],H(b,c);d&&B()}function K(){void 0!==ba.timer&&(clearTimeout(ba.timer),ba.timer=void 0)}function L(a,b){var c=Date.now();e.invalidate&&console.log("invalidateDoUpdate count: "+ba.count+", timeSince: "+(c-ba.lastTime)),ba.count=0,ba.lastTime=Date.now(),u.update(a,b)}function M(a){if(a.__color__)return a.__color__;for(var b,c=0;10>c&&(a.__color__=$(Z++),b=_.indexOf(a.__color__),!(0>b));)c++;return _.push(a.__color__),a.__color__}f||(f={}),f.seriesData||(f.seriesData=function(a){return a}),f.seriesLabel||(f.seriesLabel=function(a,b){return"Series "+b}),f.x1||(f.x1=function(a){return a[0]}),f.y1||(f.y1=function(a){return a[1]});var N=a.trait.utils.configMargin(f.margin,{top:5,right:5,bottom:5,left:5});f.clip=void 0===f.clip||f.clip===!0;var O={},P=[],Q={left:0,right:0,top:0,bottom:0};if(f.minRangeMargin)for(var R in f.minRangeMargin)i(R,f.minRangeMargin[R]);var S,T,U={width:!0,height:!0},V="cubic-in-out",W=k(),X=Math.max(0,W.width-N.left-N.right),Y=Math.max(0,W.height-N.top-N.bottom),Z=0,$=j(),_=[],aa={},ba={lastTime:0,timer:void 0},ca=0,da="chartResized",ea="rangeMarginChanged",fa=a.dispatch(da,ea);return u.subscribeToEvents=function(a,b){return a?(b.forEach(function(b){var c;"onChartMouseMove"===b?c=function(){var a=arguments;T&&T.each(function(b){var c=this,d=a[0];d.x=Math.min(d.x,X),d.y=Math.min(d.y,Y),n(c,d,!0,!1,N.left,N.top)})}:"onChartMouseOut"===b&&(c=function(){arguments;T&&T.each(function(a){var b=this;o(b,!1)})}),c&&a[b](c)}),this):this},u.onFocusChange=function(a,b,c){return A("__onFocusChangeListeners",a,b,c)},u.onChartMouseMove=function(a,b,c){return A("__onChartMouseMoveListeners",a,b,c)},u.onChartMouseOut=function(a,b,c){return A("__onChartMouseOutListeners",a,b,c)},u.remove=function(){T&&T.each(function(a){var b=this;b._svg&&(b._svg.remove(),delete b._svg,delete b._svgDefs,delete b._container,delete b._chartGroup,delete b._chartGroupClipPath,delete b._chartGroupClipPathRect,delete b.__onFocusChangeListeners,delete b.__onChartMouseOutListeners)})},u.layoutAxis=function(a,b,c,d){var f=D(b),g=I(c,d);e.layoutAxes&&(console.log("layoutAxis( "+a+", "+c+", "+d+") BEGIN width:"+W.width+" height:"+W.height+" margin l:"+N.left+" r:"+N.right+" t:"+N.top+" b:"+N.bottom),P.forEach(function(a){console.log("   "+a.name+", "+a.orient+" origin:"+a.rect.origin.x+","+a.rect.origin.y+" size:"+a.rect.size.width+","+a.rect.size.height+" anchor:"+a.rect.anchor.x+","+a.rect.anchor.y)})),f?(f.orient!==c||f.rect.size!==g.size)&&(f.orient=c,f.rect=g,J()):(f={name:a,group:b,orient:c,rect:g},P.push(f),J()),e.layoutAxes&&(console.log("layoutAxis( "+a+", "+c+", "+d+") END   width:"+W.width+" height:"+W.height+" margin l:"+N.left+" r:"+N.right+" t:"+N.top+" b:"+N.bottom),P.forEach(function(a){console.log("   "+a.name+", "+a.orient+" origin:"+a.rect.origin.x+","+a.rect.origin.y+" size:"+a.rect.size.width+","+a.rect.size.height+" anchor:"+a.rect.anchor.x+","+a.rect.anchor.y)})),f.group.attr("transform","translate("+f.rect.origin.x+","+f.rect.origin.y+")")},u.getFocusItems=function(a){return[]},u.update=function(a,b){},u.invalidate=function(a,b){var c=Date.now();return"domain"===a?(K(),void L(a,b)):void(ba.timer?ba.count++:c-ba.lastTime>1e3?L(a,b):(ba.count=0,ba.timer=setTimeout(function(){ba.timer=void 0,L(a,b)},1e3)))},u.select=function(){return S},u.color=function(a,b){switch(arguments.length){case 1:return M(a);case 3:return M(a);case 2:return a.__color__=b,this;default:return"black"}},u.size=function(b){return arguments.length?(U=!1,W.width=parseInt(b.width,10),W.height=parseInt(b.height,10),e.resize&&console.log("chartBase.size( weight="+W.width+", height="+W.height+")"),B(),this):new a.trait.Size(W.width,W.height)},u.width=function(a){return arguments.length?(U=!1,W.width=parseInt(a,10),e.resize&&console.log("chartBase.width( "+W.width+")"),B(),this):W.width},u.height=function(a){return arguments.length?(U=!1,W.height=parseInt(a,10),e.resize&&console.log("chartBase.height( "+W.height+")"),B(),ca=0,this):W.height},u.marginTop=function(a){return arguments.length?(N.top=a,B(),this):N.top},u.marginBottom=function(a){return arguments.length?(N.bottom=a,B(),this):N.bottom},u.marginLeft=function(a){return arguments.length?(N.left=a,B(),this):N.left},u.marginRight=function(a){return arguments.length?(N.right=a,B(),this):N.right},u.plusMarginTop=function(a){return N.top+=parseInt(a,10),B(),this},u.plusMarginBottom=function(a){return N.bottom+=parseInt(a,10),B(),this},u.plusMarginLeft=function(a){return N.left+=parseInt(a,10),B(),this},u.plusMarginRight=function(a){return N.right+=parseInt(a,10),B(),this},u.chartRect=function(){return new a.trait.Rect(N.left,N.top,X,Y)},u.chartWidth=function(a){return arguments.length?(X=parseInt(a,10),C(),this):X},u.chartHeight=function(a){return arguments.length?(Y=parseInt(a,10),C(),this):Y},u.ease=function(a){return arguments.length?(V=a,this):V},u.duration=function(a){return arguments.length?(ca=a,this):ca},u.onChartResized=function(a,b){var c=da;a&&a.length>0&&(c=c+"."+a),fa.on(c,function(){T&&T.call(b)})},u.minRangeMargin=i,u.isMinRangeMargin=h,u.minRangeMarginLeft=function(a,b){return arguments.length?1===arguments.length?O[a]?O[a].left:0:(g(a),O[a].left<b&&(O[a].left=b,fa.rangeMarginChanged()),this):0},u.minRangeMarginRight=function(a,b){return arguments.length?1===arguments.length?O[a]?O[a].right:0:(g(a),O[a].right<b&&(O[a].right=b,fa.rangeMarginChanged()),this):0},u.minRangeMarginTop=function(a,b){return arguments.length?1===arguments.length?O[a]?O[a].top:0:(g(a),O[a].top<b&&(O[a].top=b,fa.rangeMarginChanged()),this):0},u.minRangeMarginBottom=function(a,b){return arguments.length?1===arguments.length?O[a]?O[a].bottom:0:(g(a),O[a].bottom<b&&(O[a].bottom=b,fa.rangeMarginChanged()),this):0},u.onRangeMarginChanged=function(a,b){var c=ea;a&&a.length>0&&(c=c+"."+a),b?fa.on(c,function(){T&&T.call(b)}):fa.on(c)},u}var d=1,e={layoutAxes:!1,resize:!1,invalidate:!1};b.chart.base=c}(d3,d3.trait),function(a,b){function c(c,d){function e(a,b,c,d,e,f){var g,h;for(void 0===e&&(e=0),void 0===f&&(f=a.length-1);f>=e;)if(g=Math.floor((e+f)/2),h=b(a[g]),c>h)e=g+1;else{if(!(h>c))return g;f=g-1}return 0>d?0>e+d?0:e+d:f+d>=a.length?a.length-1:f+d}function f(c){var f,g,h,i,j=n.range(),k=a.trait.utils.extentMax(j),l=n.invert?n.invert(j[0]):0,o=n.invert?n.invert(k):j.length-1,p=d.seriesData(c);if(p=b.murts.utils.getOrElse(p,n),f=e(p,m.x,l,-1),g=e(p,m.x,o,1,f,p.length-1),h=g===p.length-1,(f>0||!h)&&(p=p.slice(f,g+1)),i=s(p),i&&h&&r){var q=1.1*k;q.toFixed(),i+="H"+q}return i}function g(b){var c=g;b.each(function(b){if(!h){var e=d.chartClass?"chart-line "+d.chartClass:"chart-line";h=this._chartGroup.append("g").classed(e,!0)}j=d.seriesFilter?b.filter(d.seriesFilter):b,i=h.selectAll(".series").data(j),i.selectAll("path").transition().duration(500).attr("d",f),i.enter().append("g").attr("class","series").append("path").attr("class","line").attr("d",f).style("stroke",c.color),i.exit().transition().style({opacity:0}).remove(),a.trait.utils.isData(j,d.seriesData)&&(k=a.trait.utils.extentMax(n.domain()))})}var h,i,j,k,l=b.config.axes(d),m=b.config.accessorsXY(d,l),n=c[l.x](),o=c[l.y](),p=a.trait.focus.utils.makeConfig(d),q=d.interpolate||"linear",r=d.trend&&("linear"===q||"step-after"===q),s=a.svg.line().interpolate(q).x(function(a){return n(m.x(a))}).y(function(a){return o(m.y(a))});return g.update=function(a,d){this._super(a,d);var e=void 0===d?c.duration():d;return k=b.chart.utils.updatePathWithTrend(a,e,n,i,f,k),this},g.getFocusItems=function(a){var c=this._super(a),d=b.focus.utils.getFocusItems(j,a,p,m,n,o,g.color);return c=c.concat(d)},g}b.chart.line=c}(d3,d3.trait),function(a,b){function c(a,b,c,d,e,f){return{x:function(c){return e(a.x(c))+b},y:function(b){return f(a.y(b))},width:c,height:function(b){return d-f(a.y(b))}}}function d(a,b,c){return{cx:function(c){return b(a.x(c))},cy:function(b){return c(a.y(b))},r:8}}function e(e,f){function g(b){var c=g;b.each(function(b){var e=this,g=f.seriesFilter?b.filter(f.seriesFilter):b;if(!h){var k=f.chartClass?"chart-scatter "+f.chartClass:"chart-scatter";h=this._chartGroup.append("g").classed(k,!0)}i=h.selectAll(".series").data(g),i.enter().append("g").attr("class","series").style("fill",c.color),j=i.selectAll(r).data(o.seriesData),j.transition().duration(500).delay(500).ease(c.ease()).attr(d(o,p,q)),j.enter().append(r).classed("scatter-point",!0).attr(d(o,p,q)).on("mouseover",function(a,b){return e._svg.append("text").text("data: "+o.y(a).toFixed(1)).attr("id","tooltip").attr("x",p(o.x(a))+10).attr("y",q(o.y(a))).attr("fill","black").attr("opacity",0).style("font-family","sans-serif").transition().attr("opacity",1)}).on("mouseout",function(){a.select(this).transition().duration(500).attr("fill","slateblue"),a.selectAll("#tooltip").transition().duration(500).attr("opacity",0).remove()}),j.exit().transition().style({opacity:0}).remove(),m=a.trait.utils.extentMax(p.domain())})}var h,i,j,k,l,m,n=b.config.axes(f),o=b.config.accessorsXY(f,n),p=e[n.x](),q=e[n.y](),r="circle",s=a.dispatch("customHover");return g.update=function(b,d){this._super(b,d);var f=a.trait.utils.extentMax(p.domain()),g=p(m)-p(f);return i.attr("transform",null),j.attr(c(o,l,k,e.chartHeight(),p,q)),j=i.selectAll("rect").data(o.seriesData),j.enter().append("rect").classed("bar",!0).attr(c(o,l,k,e.chartHeight(),p,q)),j.exit().transition().style({opacity:0}).remove(),0===d?i.attr("transform","translate("+g+")"):i.transition().duration(d||e.duration()).ease("linear").attr("transform","translate("+g+")"),m=a.trait.utils.extentMax(p.domain()),this},a.rebind(g,s,"on"),e.onRangeMarginChanged("chartScatter",g),g}b.chart.scatter=e}(d3,d3.trait),function(a,b){function c(b,c){function d(){var a=p.empty()?m.domain():p.extent();e(a,"domain",0)}function e(a,b,c){n[o+"Domain"](a),n.update(b,c)}function f(b){var d=f;b.each(function(b){if(!i){var e="brush brush-"+k,f=c.chartClass?e+c.chartClass:e;i=this._chartGroup.append("g").classed(f,!0)}i.call(p),i.selectAll("rect").attr("y",-6).attr("height",d.chartHeight()+7),j=a.trait.utils.extentMax(m.domain())})}function g(b,c){var d={min:a.trait.utils.extentMin(b),max:a.trait.utils.extentMax(b)};if(d.max instanceof Date){var e=d.min.getTime(),f=d.max.getTime();d.isDate=!0,d.span=Math.abs(f-e),d.spanEpsilon=.025*d.span,d.isExtentMax=Math.abs(f-c.getTime())<d.spanEpsilon}else d.isDate=!1,d.span=Math.abs(d.max-d.min),d.spanEpsilon=.025*d.span,d.isExtentMax=Math.abs(d.max-c)<d.spanEpsilon;return d}function h(a,b){return b instanceof Date?new Date(b.getTime()-a.span):b-a.span}var i,j,k=c.axis,l=k.charAt(0),m=b[k](),n=c.target,o=c.targetAxis,p=(n[c.targetAxis](),a.svg.brush()[l](m));p.on("brush",d);var q=a.dispatch("customHover");return f.update=function(b,c){if(this._super(b,c),p.empty())d();else{var f=p.extent(),k=g(f,j);if(k.isExtentMax){var l=a.trait.utils.extentMax(m.domain()),n=h(k,l);p.extent([n,l])}else p.extent(f),f=p.extent();e(f,"trend",250)}return i.call(p),j=a.trait.utils.extentMax(m.domain()),this},a.rebind(f,q,"on"),f}b.control.brush=c}(d3,d3.trait),function(a,b){function c(b,c,d){function e(a){var c=b.chartHeight(),d=b.marginLeft(),e=b.marginTop();if(!a||a.x!==i){if(a){0===k.length&&(k[0]=[]);var f=k[0];f[0]=[a.x+d,e],f[1]=[a.x+d,c+e],i=a.x}else k.length>0&&k.splice(0,1),i=void 0;h=g.selectAll(".crosshair").data(k),h.enter().append("g").attr("class","crosshair").append("path").attr({"class":"line",d:function(a){return j(a)}}),h.selectAll("path").attr("d",function(a){return j(a)}),h.exit().style({opacity:0}).remove()}}function f(a){var b=f;a.each(function(a){var c=this;g||(g=c._container.append("g").attr({"class":"crosshair-group"}),b.onChartMouseMove(e,c),b.onChartMouseOut(e,c))})}var g,h,i,j=a.svg.line(),k=[];c.axis||"x1";return f}b.focus.crosshair=c}(d3,d3.trait),function(a,b){function c(a,b){return"l"+a+","+b}function d(a,b,c,d){return"q"+a+","+b+" "+c+","+d}function e(a,b){return"m"+a+","+b}function f(a){return Math.max(.16*a,6)}function g(a,b,f,g,h,i){var j=h.x<.5?1:-1,k=Math.floor(b/2-g-f),l=2*k+2*g,m=Math.floor(a-f-f),n=e(0,0+i)+c(j*g*2,-g-i)+c(0,-k)+d(0,-f,j*f,-f)+c(j*m,0)+d(j*f,0,j*f,f)+c(0,l)+d(0,f,j*-f,f)+c(j*-m,0)+d(j*-f,0,j*-f,-f)+c(0,-k)+"z";return n}function h(a){a.forEach(function(a){a&&(a.remove=!0)})}function i(a){a.forEach(function(b,c){b&&b.remove&&(b.group.remove(),a[c]=null)})}function j(a){delete a.lastFoci,a.tooltips&&a.tooltips.forEach(function(b,c){b&&(b.group.remove(),a.tooltips[c]=null)})}function k(c,d,e){function k(c){var p=k;c.each(function(c){function k(e,k){if(e.length<=0)return void j(r);if(c.length<=0)return void console.error("tooltipDiscrete.focusChange foci.length="+e.length+" but _data.length="+c.length);var s=new b.Point(0,.5);h(r.tooltips),e.forEach(function(a,e,g){var h,i=c.indexOf(a.series),j=i>=0?r.tooltips[i]:null,k=o(d.x1(a.item)),l=d.y1(a.item);if(0>i)return void console.error("tooltipDiscrete.focusChange forci.forEach seriesIndex="+i+" but should have found a series.");d.formatY&&(l=d.formatY(l)),h=k+" "+l,j||(j={newby:!0},j.group=q._container.append("g").attr({id:"tooltip",opacity:0}),j.path=j.group.append("path").attr("fill","darkgray"),j.text=j.group.append("text").attr({"font-family":"monospace","font-size":10,fill:"black","text-rendering":"geometric-precision"}),r.tooltips[i]=j),j.remove=!1,j.text.text(h);var m=j.text.node().getBBox();m.height=2*m.height+2*n,m.width+=2*n+f(m.height),a.rect=new b.Rect(a.point,m,s)}),b.layout.verticalAnchorLeftRight(e,p.chartRect()),e.forEach(function(b,d,e){var h=c.indexOf(b.series),i=r.tooltips[h],j=a.rgb(b.color).darker(1.4).toString(),k=b.point.y-b.rect.origin.y,o=f(b.rect.size.height),p=g(b.rect.size.width,b.rect.size.height,m,o,b.rect.anchor,k),q=2*o+n+m,s=b.rect.anchor.x<.5?q:-b.rect.size.width-n-m;i.text.attr("transform","translate("+s+",0)"),i.newby?(i.group.attr("transform","translate("+b.rect.origin.x+","+b.rect.origin.y+")"),i.group.transition().attr("opacity",1)):i.group.transition().attr({opacity:1,transform:"translate("+b.rect.origin.x+","+b.rect.origin.y+")"}),i.path.transition().duration(l).attr({opacity:.72,fill:b.color,stroke:j,d:p}),i.newby=!1}),i(r.tooltips),r.lastFoci=e}if(0!==c.length){var q=this,r=b.utils.getTraitCache(q,e);r.tooltips=c.map(function(a){return null}),p.onChartMouseOut(function(){j(r)},q),p.onFocusChange(k,q)}})}var l=(d.axis,b.utils.configFloat(d.transitionDuration,100)),m=6,n=3,o=d.formatX||q;return k}function l(a,b){if(!b)return a;var c=a.filter(function(a,c,d){return b(a.series)});return c}function m(a,c){this.config=a,this.group=c,this.rect=new b.Rect(0,0,0,0,0,.5),this.children=[],this.dirtyRows=[],this.radius=2,this.element=c.append("rect").attr({x:0,y:0,rx:this.radius,ry:this.radius})}function n(a,c,d){this.focusTable=a,this.focus=c,this.rect=new b.Rect,this.children=d,this.config=a.config,this.item=c.item,this.group=this.focusTable.group.append("g").attr({"class":"d3-trait-tooltip-row"}),this.setFocus(c)}function o(a){return a}function p(a,c,d){function e(a){var b=c.y1(a.item);return c.formatY&&(b=c.formatY(b)),b}function f(a,c,d){var e=8,f=c.x+d.origin.x,g=c.y+d.origin.y;a.rect.origin.x=f,a.rect.origin.y=g,a.rect.size.width+=e,b.layout.verticalAnchorLeftRight([a],d),a.rect.size.width-=e,a.rect.anchor.x<.5?a.rect.origin.x+=e:a.rect.origin.x-=e}function g(a,c){var d=a[0][0].getBBox(),e=c?c.x*d.width:0,f=0;return new b.Rect(e,f,d.width,d.height,c?c.x:0,0)}function h(a,b){var c=0===b?y.top+1:y.top+(y.top+y.bottom+1)*b+1;return c+"em"}function i(a,b){var c=0===b?y.top+.64:y.top+(y.top+y.bottom+1)*b+.64;return c+"em"}function j(a,b){var c=0,d=0,e=a.rect.size;return b>0&&(c=1===b?e.height/(1+y.top):e.height/(y.top+1+(y.top+y.bottom+1)*(b-1)),d=c*y.bottom,e.height+=d),c}function k(a,b){var c;return c=a.group.selectAll("text").data(b),c.enter().append("text").attr("y",h).attr("x",0).style("text-anchor",a.textAnchor).text(a.accessValue),c.text(a.accessValue),c.exit().remove(),a.rect=g(a.group,a.anchor),
a.em=j(a,b.length),a.em}function m(a,b,c){var d;return d=a.group.selectAll("circle").data(b),d.enter().append("circle").attr("cy",i).attr("cx","0.5em").attr("r","0.4em").style("fill",function(a){return c(a.series)}),d.style("fill",function(a){return c(a.series)}),d.exit().remove(),a.rect=g(a.group,a.anchor),a.em=j(a,b.length),a.em}function n(a,b,c){var d,e=10;a.limit&&(b=b.slice(0,a.limit)),a.children.forEach(function(a){"text"===a.type?e=k(a,b):d=a}),d&&m(d,b,c)}function p(b,d,e){var g;b=b.reverse(),g=l(b,c.seriesFilter),w.children.forEach(function(a){n(a,g,e)}),D(w),f(w,d,a.chartRect()),v.attr("transform","translate("+w.rect.minX()+","+w.rect.minY()+")"),C.attr({x:.5,y:Math.round(w.em*-.25)+.5,rx:x,ry:x,width:Math.round(w.rect.size.width+.1*w.em),height:Math.round(w.rect.size.height+.25*w.em)}),v.style("opacity",1)}function q(a){a.children.forEach(function(a){a.group=v.append("g").classed(a.klass,!0),a.children.forEach(function(b){b.group=a.group.append("g").classed(b.klass,!0).attr("transform","translate(0,0)")})})}function u(a){function b(a,b){p(a,b,d.color)}function c(){v&&v.transition().duration(100).style("opacity",0)}var d=u;a.each(function(a){var e=this;v||(v=e._container.append("g").attr({"class":"d3-trait-tooltip"}),C=v.append("rect").classed(E.box,!0),q(w),d.onFocusChange(b,e),d.onChartMouseOut(c,e))})}var v,w,x=(c.axis,b.utils.configFloat(c.transitionDuration,100),b.utils.configFloat(c.radius,3)),y=c.padding||new b.Margin(0,.6,.25),z=10,A=c.formatHeader||o,B=c.target;B&&!Array.isArray(B)&&(B=[B]);var C,D=b.layout.tilestack().paddingEm(y).translate(function(a,b,c){a.group.attr("transform","translate("+b+","+c+")")}),E={main:c["class"]||"d3-trait-tooltip"};return E.box=E.main+"-box",w={group:void 0,klass:E.main+"-table",layoutChildren:"TopToBottom",em:z,children:[{group:void 0,klass:E.main+"-header",limit:1,anchor:t,layoutChildren:"LeftToRight",em:z,children:[{type:"text",group:void 0,klass:E.main+"-header-td",anchor:r,textAnchor:"start",accessValue:function(a){return A(c.x1(a.item))},em:z}]},{group:void 0,klass:E.main+"-body",anchor:t,layoutChildren:"LeftToRight",em:z,children:[{type:"mark",group:void 0,klass:E.main+"-mark",anchor:s,textAnchor:"end",accessValue:e,em:z},{type:"text",group:void 0,klass:E.main+"-value",anchor:s,textAnchor:"end",accessValue:e,em:z},{type:"text",group:void 0,klass:E.main+"-label",anchor:r,textAnchor:"start",accessValue:function(a){return c.seriesLabel(a.series)},em:z}]}]},u}var q=a.time.format("%Y-%m-%d"),r=new b.Point(0,1),s=new b.Point(1,1),t=(new b.Point(.5,1),new b.Point(0,0));new b.Point(0,.5),new b.Point(.5,.5);m.prototype.addRow=function(a){var b=[{anchor:s,accessValue:function(a,b){return b.y1(a.item)},format:this.config.formatY},{anchor:r,accessValue:function(a,b){return b.seriesLabel(a.series)}}],c=new n(this,a,b);return this.children.push(c),c},m.prototype.getRow=function(a){return this.children[a]},m.prototype.rowCount=function(){return this.children.length},m.prototype.rowDirty=function(a){this.dirtyRows.push(a)},m.prototype.truncateRows=function(a){},m.prototype.setHeaderRow=function(a){if(this.header)this.header.setFocus(a);else{var b=[{colspan:2,anchor:r,accessValue:function(a,b){return b.x1(a.item)},format:this.config.formatHeader}];this.header=new n(this,a,b),this.children.unshift(this.header)}return this.header},m.prototype.render=function(a,b,c){0!==this.dirtyRows.length&&(a(this),this.setOrigin(b,c),this.group.attr("transform","translate("+this.rect.minX()+","+this.rect.minY()+")"),this.renderTableBox(),this.children.forEach(function(a,b){a.render()}),this.dirtyRows=[])},m.prototype.setOrigin=function(a,c){var d=8,e=a.x+c.origin.x,f=a.y+c.origin.y;this.rect.origin.x=e,this.rect.origin.y=f,this.rect.size.width+=d,b.layout.verticalAnchorLeftRight([this],c),this.rect.size.width-=d,this.rect.anchor.x<.5?this.rect.origin.x+=d:this.rect.origin.x-=d},m.prototype.renderTableBox=function(){this.element.attr({width:this.rect.size.width,height:this.rect.size.height+2}),this.group.transition().style("opacity",1)},n.prototype.setFocus=function(a){var b=this,c=!1;return b.focus=a,b.item=a.item,b.children.forEach(function(a){a.element||(a.element=b.group.append("text"),a.anchor===s&&a.element.style("text-anchor","end")),c=c||b.setCol(a,a.accessValue,a.anchor,a.format)}),c&&b.focusTable.rowDirty(b),c},n.prototype.setCol=function(a,c,d,e){var f=a.accessValue(this.focus,this.config);return a.value&&a.value===f&&!a.rect&&console.error("how did we get here!"),a.value&&a.value===f?!1:(a.value=f,a.text=e?e(f):f,a.element.text(a.text),a.bbox=a.element.node().getBBox(),a.rect=new b.Rect(0,0,a.bbox.width,a.bbox.height,d.x,d.y),!0)},n.prototype.render=function(){var a=this.rect.origin;this.group.attr("transform","translate("+this.rect.minX()+","+this.rect.minY()+")"),this.children.forEach(function(b,c){a=b.rect.origin,b.element.attr("transform","translate("+a.x+","+a.y+")")})};({transition:{duration:100},radius:3,paddingEm:new b.Margin(0,.6,.25),offsetX:8,em:void 0,formatHeader:o,targets:void 0});b.focus.tooltip||(b.focus.tooltip={}),b.focus.tooltip.discrete=k,b.focus.tooltip.unified=p}(d3,d3.trait),function(a,b){function c(a,b){"true"===a.stacked&&console.error("label.side config stacked:'true' should not have quotes. Ignored.");var c={width:a.width||"auto",orient:a.orient||"right",labelOffset:a.labelOffset||10,gutter:a.gutter||10,lineHeight:a.lineHeight||10,stacked:a.stacked===!0,formatY:a.formatY};return c}function d(a,c,d,e,f,g,h){function i(a,c){return new b.Rect(0,e(a,c),0,g+h,0,1)}function j(a){return void 0!==a.d?a.d.rect=i(a.d,a.di):k=!1,a.d}var k=!0,l=a.map(function(a,b){return d(a,b)}),m=l.map(j);k&&b.layout.vertical(m,f)}function e(e,f){function g(a,b){var c,d=r.seriesData(a,b);switch(u.orient){case"left":c=0;break;case"right":c=d.length-1;break;default:c=d.length-1}var e=d.length>0?d[c]:void 0;return{d:e,di:c}}function h(a,b){var c=r.y(a,b),d=t(Math.max(c,0)),e=t(0)-t(Math.abs(c));return d+e/2}function i(a,b){var c=(t(0)-t(a.size))/2;return t(a.y0)+c}function j(a,b){var c=g(a,b);return void 0!==c.d?c.d.rect.origin.y:0}function k(a,b){var c,d=g(a,b);return c=void 0!==d.d?r.y(d.d,d.di):0,u.formatY&&(c=u.formatY(c)),c}function l(a,b,c){if("left"===c.orient){var d=b-c.labelOffset-2*c.lineHeight;return{value:{x:d,anchor:"start"},label:{x:d-c.gutter,anchor:"end"}}}var e=a+b+c.labelOffset+1*c.lineHeight;return{value:{x:e,anchor:"end"},label:{x:e+c.gutter,anchor:"start"}}}function m(a){var b=m;a.each(function(a){var c=e.chartWidth();if(p=v(a),!n){var h=f.labelClass?"label-edge "+f.labelClass:"label-edge";n=this._container.append("g").classed(h,!0)}d(p,r,g,w,b.chartRect(),10,2),o=n.selectAll(".series").data(p);var i=o.enter().append("g").attr("class","series").style("fill",b.color),m=l(c,b.marginLeft(),u);i.append("text").attr("class","value").attr("x",m.value.x).attr("y",j).attr("dy",".35em").style("text-anchor",m.value.anchor).text(k),i.append("text").attr("class","label").attr("x",m.label.x).attr("y",j).attr("dy",".35em").style("text-anchor",m.label.anchor).text(f.seriesLabel)})}var n,o,p,q=b.config.axes(f),r=b.config.accessorsXY(f,q),s=e[q.x](),t=e[q.y](),u=(a.dispatch("customHover"),c(f,s)),v=f.seriesFilter?function(a){return a.filter(f.seriesFilter)}:function(a){return a},w=u.stacked?i:h;return m.update=function(a,b){this._super(a,b);var c=m;d(p,r,g,w,c.chartRect(),10,2);var e=l(c.chartWidth(),c.marginLeft(),u);o=n.selectAll(".series").data(p),o.exit().remove();var h=o.enter().append("g").attr("class","series").style("fill",c.color);return h.append("text").attr("class","value").attr("x",e.value.x).attr("y",j).attr("dy",".35em").style("text-anchor",e.value.anchor).text(k),h.append("text").attr("class","label").attr("x",e.label.x).attr("y",j).attr("dy",".35em").style("text-anchor",e.label.anchor).text(f.seriesLabel),o.select("text.value").attr("x",c.chartWidth()+c.marginLeft()+5).attr("y",j).text(k),o.select("text.label").attr("x",c.chartWidth()+c.marginLeft()+15).attr("y",j).text(f.seriesLabel),this},m}b.label.side=e}(d3,d3.trait),function(a,b){function c(a){return a.children}var d=new b.Margin;b.layout.table=function(){function e(a,b,c){if(!(!a||0>b||b>100))for(;a.length<b;)a.push(c)}function f(a){var b=[],c=[];return a.forEach(function(a,d){var f=p.call(o,a,a.depth);e(b,f.length,0);var h=0;f.forEach(function(a,e){var f=e+h;if(a.colspan)c.push({node:a,row:d,col:f}),h+=a.colspan;else{var i=g(a,d,f);b[f]=b[f]?Math.max(b[f],i):i}})}),c.sort(function(a,b){return a.node.colspan-b.node.colspan}),c.forEach(function(a){var c=a.node,d=h(a.col,c.colspan,b),e=g(c,c.row,c.col);e>d&&i(e,d,a.col,c.colspan,b)}),b}function g(a,b,c){var d=q.get(a,b,c),e=d.left+a.rect.size.width+d.right;return e}function h(a,b,c){var d=0;for(b--;b>=0;b--)d+=c[a+b];return d}function i(a,b,c,d,e){var f=a-b,g=f/d,h=0;for(d--;d>=0;d--){var i=c+d;e[i]=Math.round(e[i]+g),h+=e[i]}a>h&&e[c]++}function j(a,b){a.depth=b;var c=p.call(o,a,b);c&&c.length>0&&(b++,c.forEach(function(a){j(a,b)}))}function k(a,b){var c=0,d=p.call(o,a,a.depth);return d.forEach(function(a,d){var e=q.get(a,b,d),f=e.top+a.rect.size.height+e.bottom;c=Math.max(c,f)}),c}function l(a,c,d,e){var f=q.get(a,c,d),g=r.get(a,c,d),h=s.get(a,c,d),i=new b.Point;return i.x="right"===g?e.maxX()-f.right:"center"===g?Math.round(e.midX()+(f.left-f.right)/2):e.minX()+f.left,i.y="top"===h?e.minY()+f.top:"middle"===h?Math.round(e.midY()+(f.top-f.bottom)/2):e.maxY()-f.bottom,i}function m(a,c,d){var e=p.call(o,a,a.depth),f=a.rect.size.height,g=0,h=0;e.forEach(function(a,e){var i=new b.Rect(g,h,d[e],f);a.rect.origin=l(a,c,e,i),g+=i.size.width}),a.rect.size.width=g}function n(a,b){function c(c,d,e){var f=b.call(o,c,c.depth,d,e);return null==f?a.getNull(c):a.expandConstantType&&typeof f===a.expandConstantType?a.expandConstant(f):f}function d(a){return b}var e;a.get=null==(a.arg=b)?a.getNull:"function"==(e=typeof b)?c:a.expandConstantType&&e===a.expandConstantType?(b=a.expandConstant(b),d):d}function o(b){var c=b;j(c,0);var d=c.rect,e=p.call(o,c,c.depth),g=f(e),h=0;return e.forEach(function(a,b){var c=k(a,b);a.rect.origin.x=0,a.rect.origin.y=h,a.rect.size.height=c,m(a,b,g),h+=c}),d.size.width=a.sum(g),d.size.height=h-0,c}var p=c,q={arg:null,getNull:function(){return d},expandConstantType:"number",expandConstant:function(a){return new b.Margin(a)}},r={arg:"left",getNull:function(){return"left"}},s={arg:null,getNull:function(){return"bottom"}};return q.get=q.getNull,r.get=r.getNull,s.get=s.getNull,o.padding=function(a){return arguments.length?(n(q,a),o):q.arg},o.textAlign=function(a){return arguments.length?(n(r,a),o):r.arg},o.verticalAlign=function(a){return arguments.length?(n(s,a),o):s.arg},o.children=function(a){return arguments.length?(p=a,o):p},o.utils={setDepthOnNodes:j,calculateColWidths:f,calculateRowHeight:k,nodeOriginInCellRect:l,layoutRow:m},o}}(d3,d3.trait),function(a,b){var c=new b.Margin,d=function(a,b,c){};b.layout.tilestack=function(){function a(d){var e=0,g=new b.Point;d.children.forEach(function(b){b.children&&a(b),g=f[d.layoutChildren](b,g,c),e+=b.em}),d.rect=new b.Rect(0,0,g.x,g.y);var h=d.children.length;d.em=0===h?0:e/h}function e(b){return a(b),b}var f={LeftToRight:function(a,b){var e=a.rect;return b.x+=c.left*a.em,e.anchor.x<.5?(e.origin.x=b.x,d(a,e.minX(),e.origin.y),b.x+=e.size.width):(b.x+=e.size.width,e.origin.x=b.x,d(a,e.maxX(),e.origin.y)),b.x+=c.right*a.em,b.y=Math.max(b.y,e.maxY()),b},TopToBottom:function(a,b){var e=a.rect;return b.y+=c.top*a.em,e.anchor.y<.5?(e.origin.y=b.y,d(a,e.origin.x,e.minY()),b.y+=e.size.height):(b.y+=e.size.height,e.origin.y=b.y,d(a,e.origin.x,e.maxY())),b.x=Math.max(b.x,e.maxX()),b.y+=c.bottom*a.em,b}};return e.paddingEm=function(a){return arguments.length?(c=a,e):c},e.translate=function(a){return arguments.length?(d=a,e):d},e.utils={pack:a},e.layouts=f,e}}(d3,d3.trait),function(a,b){function c(a){return a}function d(a){return a.x}function e(a){return a.y}function f(a,b,c,d){a.x=b,a.y0=c,a.y=d}function g(a){for(var b=-1,c=a[0].length,d=[];++b<c;)d[b]=0;return d}b.layout.trendstack=function(){function b(c){var d=c.length;if(!d)return c;var e=c.map(function(a,c){return h.call(b,a,c)}),f=e.map(function(a){return a.map(function(a,c){return[l.call(b,a,c),m.call(b,a,c)]})}),g=i.call(b,f);e=a.permute(e,g),f=a.permute(f,g);var n,o,p,q=j.call(b,f),r=e[0].length;for(o=0;r>o;++o)for(k.call(b,e[0][o],p=q[o],f[0][o][1]),n=1;d>n;++n)k.call(b,e[n][o],p+=f[n-1][o][1],f[n][o][1]);return c}var h=c,i=function(b){return a.range(b.length)},j=g,k=f,l=d,m=e;return b.makeCursors=function(){},b.values=function(a){return arguments.length?(h=a,b):h},b.order=function(a){return arguments.length?(i="function"==typeof a?a:d3_layout_stackOrders.get(a)||d3_layout_stackOrderDefault,b):i},b.offset=function(a){return arguments.length?(j="function"==typeof a?a:d3_layout_stackOffsets.get(a)||d3_layout_stackOffsetZero,b):j},b.x=function(a){return arguments.length?(l=a,b):l},b.y=function(a){return arguments.length?(m=a,b):m},b.out=function(a){return arguments.length?(k=a,b):k},b}}(d3,d3.trait),function(a,b){function c(a){return a}function d(a){return a.x}function e(a){return a.y}function f(a,b,c){a.x=b,a.y=c}function g(a,b,c,d){a.x=b,a.y0=c,a.y=d}b.layout.uniformIterator=function(){function a(c){return b=c,g={x:void 0,y:0},b.length?(h=-1,i=n.call(a,b[0],0),i instanceof Date&&(j=!0)):(h=void 0,i=void 0),a}var b,g,h,i,j=!1,k=.01,l=c,m=f,n=d,o=e;return a.isNext=function(){return void 0!==i},a.peekNextX=function(){return i},a.next=function(c){var d,e,f;return void 0!==i&&i.valueOf()<=c.valueOf()+k?(h++,d=b[h],g.y=o.call(a,d,h),g.x=i,i=h+1<b.length?n.call(a,b[h+1],h+1):void 0,e=[g.x,g.y]):e=[c,g.y],f={},e=m.call(a,f,e[0],e[1]),f},a.values=function(b){return arguments.length?(l=b,a):l},a.x=function(b){return arguments.length?(n=b,a):n},a.y=function(b){return arguments.length?(o=b,a):o},a.out=function(b){return arguments.length?(m=b,a):m},a.epsilon=function(b){return arguments.length?(k=b,a):k},a},b.layout.uniformInterpolator=function(){function a(a){n!==c&&a.values(n),p!==d&&a.x(p),q!==e&&a.y(q),o!==g&&a.out(o),a.epsilon(m)}function h(c){var d,e;for(d=l.length-1;++d<c.length;)e=b.layout.uniformIterator(),a(e),l[d]=e;var f=c.length-l.length;f>0&&l.splice(l.length,f)}function i(a){for(var b=-1;++b<a.length;)l[b](a[b])}function j(a){return k=a,h(k),i(k),r(l)}var k,l=[],m=.01,n=c,o=f,p=d,q=e,r=b.layout.mapUniform;return j.values=function(a){if(!arguments.length)return n;n=a;for(var b=l.length;--b>=0;)l[b].values(n);return j},j.x=function(a){if(!arguments.length)return p;p=a;for(var b=l.length;--b>=0;)l[b].x(p);return j},j.y=function(a){if(!arguments.length)return q;q=a;for(var b=l.length;--b>=0;)l[b].y(q);return j},j.out=function(a){if(!arguments.length)return o;o=a;for(var b=l.length;--b>=0;)l[b].out(o);return j},j.epsilon=function(a){if(!arguments.length)return m;m=a;for(var b=l.length;--b>=0;)l[b].epsilon(m);return j},j}}(d3,d3.trait),function(a,b){function c(b,c){function d(){return"top"===g||"bottom"===g}function e(){var a,d={left:10,right:10};return c.legendMargin&&(d.left=c.legendMargin.left||d.left,d.right=c.legendMargin.right||d.right,d.top=c.legendMargin.top,d.bottom=c.legendMargin.bottom),d.left+=b.marginLeft(),d.right+=b.marginRight(),a="margin-left:"+d.left+"px;",a+="margin-right:"+d.right+"px;",d.top&&(a+="margin-top:"+d.top+"px;"),d.bottom&&(a+="margin-bottom:"+d.bottom+"px;"),a+="top:"+Math.max(0,b.marginTop()-5)+"px;"}function f(b){var h=f;b.each(function(b){if(!this._legend){var f=c.legendClass?"legend "+c.legendClass:"legend";if(d()){var i=a.select(this);this._legend="top"===g?i.insert("ul","svg"):i.append("ul"),this._legend.attr("style",e()).attr("class",f)}else this._legend=this._container.append("g").classed(f,!0)}var j=c.legendFilter?b.filter(c.legendFilter):b;if(d()){var k=this._legend.selectAll("li").data(j),l=k.enter().append("li").classed("legend-item",!0).style("border-bottom-color",h.color);l.append("span").classed("legend-mark",!0).style("background-color",h.color),l.append("span").text(c.seriesLabel)}else{var m=this._legend.selectAll(".legend").data(j);m.enter().append("g").attr("class","legend").attr("transform",function(a,b){return"translate(0,"+20*b+")"}),m.append("rect").attr("x",h.chartWidth()-18).attr("width",18).attr("height",18).style("fill",h.color),m.append("text").attr("x",h.chartWidth()-24).attr("y",9).attr("dy",".35em").style("text-anchor","end").text(c.seriesLabel)}})}var g=c.orient||"top",h=a.dispatch("customHover");return a.rebind(f,h,"on"),f}b.legend.series=c}(d3,d3.trait),function(a,b){function c(a,b,c){function d(c){var j=d;c.each(function(c){var d,k,l=this,m=a.marginLeft()+20,n=a.marginTop()+20;e||(e=l._container.append("g").attr({"class":i.main}),g=e.append("rect").classed(i.box,!0),f=e.append("g").classed(i.items,!0).attr("transform","translate("+m+","+n+")"));var o=b.legendFilter?c.filter(b.legendFilter):c;d=f.selectAll("."+i.item).data(o),k=d.enter(),k.append("text").classed(i.item,!0).attr("y",function(a,b){return b+"em"}).attr("x","1em").text(b.seriesLabel),k.append("circle").attr("cy",function(a,b){return b-.3+"em"}).attr("cx",0).attr("r","0.4em").style("fill",j.color),d.exit().remove();var p=f[0][0].getBBox();g.attr("x",Math.floor(m+p.x-h)+.5).attr("y",Math.floor(n+p.y-h)+.5).attr("height",Math.ceil(p.height+2*h)).attr("width",Math.ceil(p.width+2*h))})}var e,f,g,h=5,i={main:b["class"]||"d3-trait-legend"};return i.box=i.main+"-box",i.items=i.main+"-items",i.item=i.main+"-item",d}b.legend.standard=c}(d3,d3.trait),function(a,b){function c(a){return w.indexOf(a)>=0}function d(a,c,d){return{series:a.seriesData,data:function(a){return b.murts.utils.getOrElse(a,d)},value:a[c],scaleName:c,axisChar:c.charAt(0),scale:d}}function e(b){var c={padding:a.trait.utils.configFloat(b.domainPadding,0)};if(b.hasOwnProperty("trend"))c.type=u.TREND,c.trend=b.trend;else if(b.hasOwnProperty("domain"))if(Array.isArray(b.domain))c.type=u.DOMAIN,c.domain=b.domain;else if("object"==typeof b.domain){var d=a.trait.utils.configFloat(b.domain.min,null),e=a.trait.utils.configFloat(b.domain.max,null);null!==d&&null!==e?(c.type=u.DOMAIN,c.domain=[d,e]):null!==d?(c.type=u.MIN,c.min=d):null!==e?(c.type=u.MAX,c.max=e):(c.type=u.DATA,console.error("makeDomainConfig: Unrecognized domain specification: "+JSON.stringify(b.domain)))}else"manual"===b.domain||"MANUAL"===b.domain?c.type=u.MANUAL:c.type=u.DATA;else c.type=u.DATA;return c}function f(a,b){var d,e=b.count||1;return d=c(b.interval)?b.interval.offset(a,0-e):a instanceof Date?a.getTime()-b.interval*e:a-b.interval*e}function g(a,c,d,e){var g,h,i;return a.track===t?(h=new Date,g=f(h,a.domain),i=[g,h]):a.domain&&a.domain.interval?(h=b.utils.maxFromData(c,d),g=f(h,a.domain),i=[g,h]):i=b.utils.extentFromData(c,d,e),i}function h(a,b){switch(b.type){case u.MIN:a[0]=b.min;break;case u.MAX:a[a.length-1]=b.max}}function i(a,c,d){var e=[0,1];switch(c=b.murts.utils.getOrElse(c),a.type){case u.DOMAIN:e=a.domain;break;case u.TREND:e=g(a,c,d,a.padding);break;case u.MIN:e=[a.min,b.utils.maxFromData(c,d)];break;case u.MAX:e=[b.utils.minFromData(c,d),a.max];break;case u.DATA:e=b.utils.extentFromData(c,d,a.padding);break;default:console.error("scale getDomain - Unknown domainConfig.type: "+a.type)}return e}function j(a,c,d,e,g,j,l,m,o){var w,x,y,z,A,B;if(l.type!==u.MANUAL){if(l.type===u.DOMAIN)return void a.domain(l.domain);if(z=a.domain(),A=z[z.length-1],l.type===u.TREND){var C=l.trend;C.track===t?(x=new Date,w=f(x,C.domain),a.domain([w,x])):C.domain&&C.domain.interval?(x=b.utils.maxFromData(m,o),w=f(A,C.domain),a.domain([w,A]),B=a(x),w=f(x,C.domain),a.domain([w,x]),a.range([d[0],B])):(y=b.utils.extentFromData(m,o,l.padding),a.domain(y))}else{y=i(l,m,o),p&&console.log("updateScale "+c+": domainConfig.type: "+v[l.type]+" domain: "+JSON.stringify(y));var D=g([y[0],q(y)]);if(r(y,D)&&(s(y,D),a.domain(y),p&&console.log("updateScale"+c+": child trait extended domain: "+JSON.stringify(y))),e.length){var E=n.call(this,e,y);r(y,E)&&(s(y,E),p&&console.log("updateScale"+c+" union updated domain:"+y))}h(y,l),p&&console.log("updateScale"+c+": setting domain: "+JSON.stringify(y)),a.domain(y),!j.length||y[0]===z[0]&&q(y)===q(z)||k.call(this,j,a)}}}function k(a,b){if(a){var c,d;for(c=a.length;--c>=0;)d=a[c],d.call(this,b)}}function l(c,f){function g(a){var b=g;a.each(function(a){var c;h=f.seriesFilter?a.filter(f.seriesFilter):a;var d="x"===k?b.chartWidth():b.chartHeight();l.rangeRoundBands([0,d],.1),c=m.series(h[0]).map(m.value),l.domain(c)})}var h,i=f.axis,k=i.charAt(0),l=a.scale.ordinal(),m=d(f,i,l),n=(b.config.axes(f),e(f)),o=i+"ExtendDomain",q=[],r=[];return"function"!=typeof l.invert&&(l.invert=function(a){var c=l.domain();if(0===c.length)return void 0;var d=b.utils.extentMin(c),e=b.utils.extentMax(c);if(a<l(d))return d;if(a>l(e))return e;for(var f=d,g=1;g<c.length-2;g++){var h=c[g];if(l(h)>a)return f;f=h}return f}),g[i]=function(){return l},g[o]=function(a,b){return a},g.update=function(b,d){if(this._super(b,d),!h)return this;var e=a.trait.utils.getScaleRange(c,i);p&&console.log("scaleOrdinalBars.update1 "+i+" range:"+e+" domain:"+l.domain());var f="x"===k?this.chartWidth():this.chartHeight();return l.rangeRoundBands([0,f],.1),j(l,i,e,q,g[o],r,n,h,m),p&&console.log("scaleOrdinalBars.update2 "+i+" range:"+e+" domain:"+l.domain()),this},g}function m(b,c){function f(b){var d=f;b.each(function(b,e,j){var r;if(g=c.seriesFilter?b.filter(c.seriesFilter):b,r=a.trait.utils.getScaleRange(d,h),l.range(r),n.type!==u.DOMAIN&&n.type!==u.MANUAL){var s,v,w=l.domain();s=i(n,g,m),l.domain(s),p&&console.log("scaleTime.each "+h+" range:"+r+" domain:"+s),c.nice&&l.nice(c.nice),v=f[o](s,b),v!==s&&(s=v,l.domain(s),p&&console.log("scaleTime.each "+o+" updated domain:"+s)),!t.length||s[0]===w[0]&&q(s)===q(w)||k.call(this,t,l)}})}var g,h=c.axis,l=(h.charAt(0),a.time.scale()),m=d(c,h,l),n=e(c),o=h+"ExtendDomain",r=h+"AddListener",s=h+"RemoveListener",t=[],v=[];return b.minRangeMargin(h,c.minRangeMargin),n.type===u.DOMAIN&&l.domain(n.domain),c.nice&&l.nice(c.nice),f[h]=function(){return l},f[h+"Domain"]=function(a){return arguments.length?(n.type!==u.MANUAL&&(n.domain=a),void l.domain(a)):l.domain()},f[o]=function(a,b){return a},f[r]=function(a){return t[t.length]=a,n.domain&&a.call(this,l),this},f[s]=function(a){var b=t.indexOf(a);return b>=0&&t.splice(b,1),this},f.update=function(c,d){this._super(c,d);var e=a.trait.utils.getScaleRange(b,h);return l.range(e),j(l,h,e,v,f[o],t,n,g,m),this},b.onRangeMarginChanged("scaleTime-"+h,f),f}function n(a,b){for(var c,d=a.length;--d>=0;)c=a[d],s(b,c.domain());return b}function o(c,f){function g(b){var c=g;b.each(function(b){var d;if(l=f.seriesFilter?b.filter(f.seriesFilter):b,d=a.trait.utils.getScaleRange(c,m),o.range(d),v.type!==u.DOMAIN&&v.type!==u.MANUAL){var e,j,x,y=o.domain();e=i(v,l,t),o.domain(e),p&&console.log("scaleLinear.each "+m+" range:"+d+" domain:"+e),j=g[w]([e[0],q(e)],b),r(e,j)&&(s(e,j),h(e,v),o.domain(e),p&&console.log("scaleLinear.each "+w+" updated domain:"+e)),C.length&&(x=n.call(this,C,e),x!==e&&(e=x,o.domain(e),p&&console.log("scaleLinear.each "+m+" union updated domain:"+e))),!B.length||e[0]===y[0]&&q(e)===q(y)||k.call(this,B,o)}})}var l,m=f.axis,o=(m.charAt(0),a.scale.linear()),t=d(f,m,o),v=e(f),w=m+"ExtendDomain",x=m+"AddListener",y=m+"RemoveListener",z=m+"UpdateUnion",A=m+"RemoveUnion",B=[],C=[];return c.minRangeMargin(f.axis,f.minRangeMargin),v.type===u.DOMAIN&&o.domain(v.domain),g[m]=function(){return o},g[m+"Domain"]=function(a){return arguments.length?(v.type!==u.MANUAL&&(v.domain=a),void o.domain(a)):o.domain()},g[w]=function(a,b){return a},g[x]=function(a){return B[B.length]=a,v.domain&&a.call(this,o),this},g[y]=function(a){var b=B.indexOf(a);return b>=0&&B.splice(b,1),this},g[z]=function(a){var b=C.indexOf(a);return 0>b&&(C[C.length]=a),g.update(m,0),this},g[A]=function(a){var b=C.indexOf(a);return b>=0&&C.splice(b,1),g.update(m,0),this},g[m+"MinDomainExtent"]=function(a){if(!arguments.length)return v.minDomain;if(b.utils.isExtentExtended(v.minDomain,a)){v.minDomain=b.utils.extendExtent(v.minDomain,a);var c=o.domain();b.utils.isExtentExtended(c,v.minDomain)&&(c=b.utils.extendExtent(c,v.minDomain),o.domain(c))}},g.update=function(b,d){if(this._super(b,d),!l)return this;var e=a.trait.utils.getScaleRange(c,m);return p&&console.log("scaleLinear.update1 "+m+" range:"+e+" domain:"+o.domain()),o.range(e),j(o,m,e,C,g[w],B,v,l,t),p&&console.log("scaleLinear.update2 "+m+" range:"+e+" domain:"+o.domain()),this},c.onRangeMarginChanged("scaleLinear-"+m,g),g}var p=!1,q=b.utils.extentMax,r=b.utils.isExtentExtended,s=b.utils.extendExtent,t="current-time",u={DATA:0,MIN:1,MAX:2,DOMAIN:3,TREND:4,MANUAL:5},v=[];v[u.DATA]="DATA",v[u.MIN]="MIN",v[u.MAX]="MAX",v[u.DOMAIN]="DOMAIN",v[u.TREND]="TREND",v[u.MANUAL]="MANUAL";var w=[a.time.second,a.time.minute,a.time.hour,a.time.day,a.time.week,a.time.month,a.time.year];b.scale.ordinal||(b.scale.ordinal={}),b.scale.linear=o,b.scale.ordinal.bars=l,b.scale.time=m}(d3,d3.trait);